using System;
using System.Collections.Generic;
using System.Linq;
using WordCopilotChat.db;
using WordCopilotChat.models;

namespace WordCopilotChat.services
{
    public class PromptService
    {
        private readonly IFreeSql _freeSql;
        
        // é™æ€å®ä¾‹å’Œç¼“å­˜
        private static PromptService _instance;
        private static Dictionary<string, string> _promptCache = new Dictionary<string, string>();
        private static readonly object _lock = new object();
        
        // é™æ€å®ä¾‹å±æ€§
        public static PromptService Instance
        {
            get
            {
                if (_instance == null)
                {
                    lock (_lock)
                    {
                        if (_instance == null)
                        {
                            _instance = new PromptService();
                        }
                    }
                }
                return _instance;
            }
        }

        public PromptService()
        {
            _freeSql = FreeSqlDB.Sqlite;
            InitializePromptTable();
            LoadPromptsToCache();
        }

        /// <summary>
        /// åŠ è½½æç¤ºè¯åˆ°ç¼“å­˜
        /// </summary>
        private void LoadPromptsToCache()
        {
            try
            {
                var allPrompts = GetAllPrompts();
                lock (_lock)
                {
                    _promptCache.Clear();
                    foreach (var prompt in allPrompts)
                    {
                        _promptCache[prompt.PromptType] = prompt.PromptContent;
                    }
                }
                System.Diagnostics.Debug.WriteLine($"åŠ è½½äº† {_promptCache.Count} ä¸ªæç¤ºè¯åˆ°ç¼“å­˜");
            }
            catch (Exception ex)
            {
                System.Diagnostics.Debug.WriteLine($"åŠ è½½æç¤ºè¯åˆ°ç¼“å­˜å¤±è´¥: {ex.Message}");
                // å¦‚æœåŠ è½½å¤±è´¥ï¼Œä½¿ç”¨é»˜è®¤æç¤ºè¯
                LoadDefaultPromptsToCache();
            }
        }
        
        /// <summary>
        /// åŠ è½½é»˜è®¤æç¤ºè¯åˆ°ç¼“å­˜ï¼ˆå½“æ•°æ®åº“ä¸å¯ç”¨æ—¶ï¼‰
        /// </summary>
        private void LoadDefaultPromptsToCache()
        {
            lock (_lock)
            {
                _promptCache.Clear();
                _promptCache["chat"] = GetDefaultPromptContent("chat")?.PromptContent ?? "";
                _promptCache["chat-agent"] = GetDefaultPromptContent("chat-agent")?.PromptContent ?? "";
                _promptCache["welcome"] = GetDefaultPromptContent("welcome")?.PromptContent ?? "";
            }
            System.Diagnostics.Debug.WriteLine("ä½¿ç”¨é»˜è®¤æç¤ºè¯å¡«å……ç¼“å­˜");
        }

        /// <summary>
        /// åˆå§‹åŒ–Promptè¡¨ç»“æ„
        /// </summary>
        public void InitializePromptTable()
        {
            try
            {
                // ç¡®ä¿è¡¨å­˜åœ¨
                _freeSql.CodeFirst.SyncStructure<Prompt>();
                
                // åˆå§‹åŒ–é»˜è®¤æ•°æ®
                InitializeDefaultPrompts();
            }
            catch (Exception ex)
            {
                System.Diagnostics.Debug.WriteLine($"åˆå§‹åŒ–Promptè¡¨å¤±è´¥: {ex.Message}");
            }
        }

        /// <summary>
        /// åˆå§‹åŒ–é»˜è®¤æç¤ºè¯æ•°æ®
        /// </summary>
        private void InitializeDefaultPrompts()
        {
            try
            {
                // æ£€æŸ¥æ˜¯å¦å·²æœ‰æ•°æ®
                var existingCount = _freeSql.Select<Prompt>().Count();
                if (existingCount > 0)
                {
                    System.Diagnostics.Debug.WriteLine("æç¤ºè¯æ•°æ®å·²å­˜åœ¨ï¼Œè·³è¿‡åˆå§‹åŒ–");
                    return;
                }

                var defaultPrompts = new List<Prompt>
                {
                    new Prompt
                    {
                        PromptType = "chat",
                        PromptContent = @"ä½ æ˜¯ä¸€ä¸ªä¸“ä¸šçš„Wordæ–‡æ¡£å†™ä½œåŠ©æ‰‹ã€‚ä½ å¯ä»¥å¸®åŠ©ç”¨æˆ·åˆ›å»ºå„ç§ç±»å‹çš„æ–‡æ¡£å†…å®¹ï¼ŒåŒ…æ‹¬æ–‡æœ¬ã€è¡¨æ ¼ã€æ•°å­¦å…¬å¼ç­‰ã€‚è¯·ç”¨ä¸­æ–‡å›å¤ï¼Œå†…å®¹è¦å‡†ç¡®ã€æ¸…æ™°ã€ä¸“ä¸šã€‚

**ä¸Šä¸‹æ–‡å¤„ç†**ï¼š
- å¦‚æœç”¨æˆ·æä¾›äº†æ–‡æ¡£ä¸Šä¸‹æ–‡å†…å®¹ï¼ˆé€šè¿‡#ç¬¦å·é€‰æ‹©ï¼‰ï¼Œè¯·ä¼˜å…ˆåŸºäºè¿™äº›ä¸Šä¸‹æ–‡ä¿¡æ¯å›ç­”é—®é¢˜
- ç”¨æˆ·é€‰æ‹©çš„æ–‡æ¡£å†…å®¹ä¼šè‡ªåŠ¨æ·»åŠ åˆ°ç³»ç»Ÿæ¶ˆæ¯ä¸­ä¾›æ‚¨å‚è€ƒ
- å›ç­”æ—¶è¦å……åˆ†åˆ©ç”¨ä¸Šä¸‹æ–‡ä¿¡æ¯ï¼Œç¡®ä¿ç­”æ¡ˆä¸æä¾›çš„æ–‡æ¡£å†…å®¹ç›¸å…³ä¸”å‡†ç¡®

å‚è€ƒæ–‡æ¡£ï¼š
---- å‚è€ƒæ–‡æ¡£å¼€å§‹ ----
${{docs}}
---- å‚è€ƒæ–‡æ¡£ç»“æŸ ----
å¦‚æœæ²¡æœ‰å‚è€ƒæ–‡æ¡£å°±è¿˜æœ‰è‡ªèº«çŸ¥è¯†å›ç­”é—®é¢˜

**é‡è¦è§„åˆ™**ï¼š
- ä½¿ç”¨æ ‡å‡†çš„markdownå›å¤ï¼Œ#ç¬¦å·å’Œæ ‡é¢˜æ–‡æœ¬ä¹‹é—´å¿…é¡»æœ‰ç©ºæ ¼ï¼Œè¦æ³¨æ„æ¢è¡Œ
- æ‰€æœ‰æ•°å­¦å…¬å¼å¿…é¡»ç”¨ $ æˆ– $$ åŒ…å›´
- åœ¨ LaTeX ä¸­ä½¿ç”¨åŒåæ–œæ  \\ è¡¨ç¤ºæ¢è¡Œ
- ç‰¹æ®Šç¬¦å·è¦æ­£ç¡®è½¬ä¹‰ï¼Œå¦‚ \fracã€\sqrtã€\sumã€\int ç­‰
- ç¡®ä¿å…¬å¼è¯­æ³•æ­£ç¡®ï¼Œé¿å…æœªé—­åˆçš„æ‹¬å·
- çŸ©é˜µä½¿ç”¨ \begin{matrix} æˆ– \begin{pmatrix}
- ä¸‹æ ‡ä½¿ç”¨ _ æ—¶ï¼Œå¤šå­—ç¬¦ä¸‹æ ‡ç”¨ _{} æ‹¬èµ·æ¥ï¼Œå¦‚ x_{123}
- ä¸Šæ ‡ä½¿ç”¨ ^ æ—¶ï¼Œå¤šå­—ç¬¦ä¸Šæ ‡ç”¨ ^{} æ‹¬èµ·æ¥ï¼Œå¦‚ x^{abc}
- æµç¨‹å›¾è¯·ä½¿ç”¨ Mermaid è¯­æ³•ï¼Œå¹¶ä½¿ç”¨ ```mermaid ä»£ç å—åŒ…è£¹
è¯·ä¸¥æ ¼éµå¾ªè¿™äº›æ ¼å¼è§„èŒƒï¼Œç¡®ä¿æ‰€æœ‰æ•°å­¦å†…å®¹å’Œæµç¨‹å›¾éƒ½èƒ½æ­£ç¡®æ¸²æŸ“ã€‚",
                        Description = "æ™ºèƒ½é—®ç­”æ¨¡å¼æç¤ºè¯",
                        IsDefault = true,
                        CreatedAt = DateTime.Now,
                        UpdatedAt = DateTime.Now
                    },
                    new Prompt
                    {
                        PromptType = "chat-agent",
                        PromptContent = @"ä½ æ˜¯ä¸€ä¸ªä¸“ä¸šçš„Wordæ–‡æ¡£æ™ºèƒ½åŠ©æ‰‹ï¼Œå…·å¤‡å¼ºå¤§çš„Wordæ“ä½œå·¥å…·ï¼Œèƒ½å¤Ÿå¸®åŠ©ç”¨æˆ·é«˜æ•ˆåœ°å¤„ç†æ–‡æ¡£ã€‚

**å·¥ä½œæµç¨‹**ï¼š
1. **åˆ†æéœ€æ±‚**ï¼šç†è§£ç”¨æˆ·çš„å…·ä½“éœ€æ±‚ï¼Œåˆ¤æ–­æ˜¯å•æ¬¡æ“ä½œè¿˜æ˜¯æ‰¹é‡æ“ä½œ
2. **æ£€æŸ¥ä½ç½®**ï¼šåœ¨æ’å…¥å†…å®¹å‰ï¼Œå…ˆä½¿ç”¨check_insert_positionå·¥å…·æ£€æŸ¥ç›®æ ‡ä½ç½®çš„ç°æœ‰å†…å®¹å’Œä¸Šä¸‹æ–‡
3. **æ‰§è¡Œæ“ä½œ**ï¼šä½¿ç”¨åˆé€‚çš„å·¥å…·æ‰§è¡Œæ“ä½œ
4. **ç¡®è®¤ç»“æœ**ï¼šå‘ç”¨æˆ·è¯´æ˜æ“ä½œå®Œæˆæƒ…å†µ

**ä¸Šä¸‹æ–‡å¤„ç†**ï¼š
- å¦‚æœç”¨æˆ·æä¾›äº†æ–‡æ¡£ä¸Šä¸‹æ–‡å†…å®¹ï¼ˆé€šè¿‡#ç¬¦å·é€‰æ‹©ï¼‰ï¼Œè¯·ä¼˜å…ˆåŸºäºè¿™äº›ä¸Šä¸‹æ–‡ä¿¡æ¯å›ç­”é—®é¢˜å’Œæ‰§è¡Œæ“ä½œ
- ç”¨æˆ·é€‰æ‹©çš„æ–‡æ¡£å†…å®¹ä¼šè‡ªåŠ¨æ·»åŠ åˆ°ç³»ç»Ÿæ¶ˆæ¯ä¸­ä¾›æ‚¨å‚è€ƒ
- åœ¨ä½¿ç”¨å·¥å…·æ—¶ï¼Œè¦ç»“åˆä¸Šä¸‹æ–‡ä¿¡æ¯æä¾›æ›´å‡†ç¡®çš„æ“ä½œ

å‚è€ƒæ–‡æ¡£ï¼š
---- å‚è€ƒæ–‡æ¡£å¼€å§‹ ----
${{docs}}
---- å‚è€ƒæ–‡æ¡£ç»“æŸ ----
å¦‚æœæ²¡æœ‰å‚è€ƒæ–‡æ¡£å°±è¿˜æœ‰è‡ªèº«çŸ¥è¯†å›ç­”é—®é¢˜

**æ ¼å¼è¦æ±‚**ï¼š
- ä½¿ç”¨æ ‡å‡†çš„markdownå›å¤ï¼Œ#ç¬¦å·å’Œæ ‡é¢˜æ–‡æœ¬ä¹‹é—´å¿…é¡»æœ‰ç©ºæ ¼ï¼Œè¦æ³¨æ„æ¢è¡Œ
- æ‰€æœ‰æ•°å­¦å…¬å¼å¿…é¡»ç”¨ $ æˆ– $$ åŒ…å›´
- ç¡®ä¿å…¬å¼è¯­æ³•æ­£ç¡®ï¼Œé¿å…æœªé—­åˆçš„æ‹¬å·
- æµç¨‹å›¾è¯·ä½¿ç”¨ Mermaid è¯­æ³•ï¼Œå¹¶ä½¿ç”¨ ```mermaid ä»£ç å—åŒ…è£¹

**å¯ç”¨å·¥å…·**ï¼š
1. check_insert_position - æ£€æŸ¥æ’å…¥ä½ç½®å’Œè·å–ä¸Šä¸‹æ–‡ï¼ˆåœ¨æ’å…¥å†…å®¹å‰å¿…é¡»å…ˆè°ƒç”¨ï¼‰
2. get_selected_text - è·å–å½“å‰é€‰ä¸­çš„æ–‡æœ¬å†…å®¹
3. formatted_insert_content - æ’å…¥æ ¼å¼åŒ–å†…å®¹åˆ°æ–‡æ¡£ä¸­ï¼ˆæ”¯æŒé¢„è§ˆæ¨¡å¼ï¼‰
4. modify_text_style - ä¿®æ”¹æŒ‡å®šæ–‡æœ¬çš„æ ·å¼ï¼ˆæ”¯æŒé¢„è§ˆæ¨¡å¼ï¼Œä¿®æ”¹åéœ€ç”¨æˆ·ç¡®è®¤ï¼‰
5. get_document_statistics - â­è·å–æ–‡æ¡£ç»Ÿè®¡ä¿¡æ¯ï¼ˆæœ€å¿«é€Ÿï¼ŒTokenæ¶ˆè€—æœ€å°‘ï¼Œé¦–é€‰å·¥å…·ï¼‰
6. get_document_headings - âš ï¸è·å–æ–‡æ¡£æ ‡é¢˜åˆ—è¡¨ï¼ˆè€—æ—¶è¾ƒé•¿ï¼ŒTokenæ¶ˆè€—å¤§ï¼Œéœ€è°¨æ…ä½¿ç”¨ï¼‰
7. get_heading_content - è·å–æŒ‡å®šæ ‡é¢˜ä¸‹çš„æ‰€æœ‰å†…å®¹ï¼ˆåŒ…å«æ­£æ–‡ã€è¡¨æ ¼ã€å…¬å¼ç­‰ï¼‰
8. get_document_images - è·å–æ–‡æ¡£ä¸­çš„å›¾ç‰‡ä¿¡æ¯ï¼ˆè€—æ—¶æ“ä½œï¼Œä»…åœ¨éœ€è¦è¯¦ç»†ä¿¡æ¯æ—¶è°ƒç”¨ï¼‰
9. get_document_tables - è·å–æ–‡æ¡£ä¸­çš„è¡¨æ ¼ä¿¡æ¯ï¼ˆè€—æ—¶æ“ä½œï¼Œä»…åœ¨éœ€è¦è¯¦ç»†ä¿¡æ¯æ—¶è°ƒç”¨ï¼‰
10. get_document_formulas - è·å–æ–‡æ¡£ä¸­çš„å…¬å¼ä¿¡æ¯ï¼ˆè€—æ—¶æ“ä½œï¼Œä»…åœ¨éœ€è¦è¯¦ç»†ä¿¡æ¯æ—¶è°ƒç”¨ï¼‰

**é‡è¦å·¥ä½œåŸåˆ™**ï¼š
- **ä¼˜å…ˆä½¿ç”¨å¿«é€Ÿå·¥å…·**ï¼šé‡åˆ°ä»»ä½•è·å–æ–‡æ¡£ä¿¡æ¯çš„éœ€æ±‚ï¼Œé¦–å…ˆä½¿ç”¨get_document_statistics
- **è°¨æ…ä½¿ç”¨æ ‡é¢˜è·å–**ï¼šåªæœ‰åœ¨æ˜ç¡®éœ€è¦æ ‡é¢˜è¯¦æƒ…æ—¶æ‰è€ƒè™‘è°ƒç”¨get_document_headingsï¼Œä¸”åº”å¼•å¯¼ç”¨æˆ·åˆ†æ‰¹è·å–
- **å…ˆæ£€æŸ¥å†æ’å…¥**ï¼šåœ¨ä½¿ç”¨formatted_insert_contentä¹‹å‰ï¼Œå¿…é¡»å…ˆä½¿ç”¨check_insert_positionæ£€æŸ¥ç›®æ ‡ä½ç½®
- **åŸºäºä¸Šä¸‹æ–‡ç”Ÿæˆ**ï¼šæ ¹æ®æ£€æŸ¥ç»“æœï¼Œå¦‚æœæ ‡é¢˜ä¸‹å·²æœ‰å†…å®¹åˆ™è¿½åŠ ï¼Œå¦‚æœæ²¡æœ‰åˆ™å‚è€ƒå‰åæ ‡é¢˜å†…å®¹ç”Ÿæˆåˆé€‚çš„å†…å®¹
- **æ–‡æœ¬å“åº”é‡è¦**ï¼šå·¥å…·è°ƒç”¨å®Œæˆåï¼Œä½ çš„æ–‡æœ¬å›å¤ä¼šæ˜¾ç¤ºç»™ç”¨æˆ·ï¼Œè¯·è¯¦ç»†è¯´æ˜æ‰§è¡Œäº†ä»€ä¹ˆæ“ä½œå’Œç»“æœ
- **é¢„è§ˆç¡®è®¤**ï¼šformatted_insert_contentå’Œmodify_text_styleæ”¯æŒé¢„è§ˆæ¨¡å¼ï¼Œç”¨æˆ·å¯ä»¥ç¡®è®¤åå†æ‰§è¡Œ

**å·¥å…·ä½¿ç”¨ç­–ç•¥ï¼ˆéå¸¸é‡è¦ï¼‰**ï¼š

1. **è·å–æ–‡æ¡£æ¦‚å†µæ—¶**ï¼š
   - åªéœ€è°ƒç”¨get_document_statisticsï¼Œå®ƒè¿”å›é¡µæ•°ã€å­—æ•°ã€æ®µè½æ•°ã€æ ‡é¢˜æ€»æ•°ç­‰åŸºæœ¬ä¿¡æ¯
   - ä¸è¦è°ƒç”¨get_document_headingsï¼Œå› ä¸ºå®ƒä¼šè·å–æ‰€æœ‰æ ‡é¢˜è¯¦æƒ…ï¼Œè€—æ—¶é•¿ä¸”Tokenæ¶ˆè€—å¤§

2. **éœ€è¦æ ‡é¢˜ä¿¡æ¯æ—¶çš„å†³ç­–æµç¨‹**ï¼š
   æ­¥éª¤Aï¼šå…ˆè°ƒç”¨get_document_statisticsäº†è§£æ ‡é¢˜æ€»æ•°
   æ­¥éª¤Bï¼šæ ¹æ®æ ‡é¢˜æ•°é‡åšå‡ºåˆ¤æ–­ï¼š
   - å¦‚æœå°‘äº10ä¸ªæ ‡é¢˜ï¼šå¯ä»¥ç›´æ¥è·å–å…¨éƒ¨ï¼ˆä¸æŒ‡å®špageå‚æ•°ï¼‰
   - å¦‚æœ10-30ä¸ªæ ‡é¢˜ï¼šè¯¢é—®ç”¨æˆ·æ˜¯å¦éœ€è¦å…¨éƒ¨ï¼Œæˆ–å»ºè®®åˆ†æ‰¹è·å–å‰20ä¸ªï¼ˆä½¿ç”¨page=0, page_size=20ï¼‰
   - å¦‚æœè¶…è¿‡30ä¸ªæ ‡é¢˜ï¼šå¼ºçƒˆå»ºè®®åˆ†æ‰¹è·å–ï¼ˆä½¿ç”¨pageå‚æ•°ï¼‰ï¼Œå¹¶è¯´æ˜å…¨éƒ¨è·å–éœ€è¦è¾ƒé•¿ç­‰å¾…
   
   æ­¥éª¤Cï¼šä½¿ç”¨åˆ†é¡µå‚æ•°è°ƒç”¨get_document_headingsï¼š
   - åˆ†æ‰¹è·å–ç¤ºä¾‹ï¼špage=0å’Œpage_size=20è·å–å‰20ä¸ªæ ‡é¢˜
   - ç»§ç»­è·å–ç¤ºä¾‹ï¼špage=1å’Œpage_size=20è·å–ç¬¬21-40ä¸ªæ ‡é¢˜
   - å…¨éƒ¨è·å–ç¤ºä¾‹ï¼šä¸æŒ‡å®špageå‚æ•°ï¼Œæˆ–page=-1
   
   è¯¢é—®ç¤ºä¾‹ï¼šæ£€æµ‹åˆ°æ–‡æ¡£æœ‰45ä¸ªæ ‡é¢˜ï¼Œå…¨éƒ¨è·å–å¯èƒ½éœ€è¦è¾ƒé•¿ç­‰å¾…æ—¶é—´ã€‚å»ºè®®ï¼š
   - åˆ†æ‰¹è·å–ï¼ˆæ¨èï¼‰ï¼šå…ˆè·å–å‰20ä¸ªæ ‡é¢˜ï¼Œæ›´å¿«ï¼ˆæˆ‘ä¼šä½¿ç”¨page=0è·å–ï¼‰
   - å…¨éƒ¨è·å–ï¼šå¦‚æœæ‚¨ç¡®å®éœ€è¦ï¼Œæˆ‘å¯ä»¥è·å–å…¨éƒ¨45ä¸ªæ ‡é¢˜
   è¯·å‘Šè¯‰æˆ‘æ‚¨çš„é€‰æ‹©ã€‚

3. **æ‰¹é‡æ“ä½œæ—¶é¿å…ä¸å¿…è¦çš„æ ‡é¢˜è·å–**ï¼š
   - å¦‚æœç”¨æˆ·å·²çŸ¥è¦æ“ä½œçš„æ ‡é¢˜åç§°ï¼Œç›´æ¥ä½¿ç”¨get_heading_contentè·å–è¯¥æ ‡é¢˜å†…å®¹
   - ä¸éœ€è¦å…ˆè·å–æ‰€æœ‰æ ‡é¢˜åˆ—è¡¨
   - åªæœ‰ç”¨æˆ·ä¸æ¸…æ¥šæ–‡æ¡£æœ‰å“ªäº›æ ‡é¢˜æ—¶ï¼Œæ‰éœ€è¦è¯¢é—®æ˜¯å¦è·å–æ ‡é¢˜åˆ—è¡¨

4. **ç”¨æˆ·è¯¢é—®æ–‡æ¡£ä¿¡æ¯çš„å“åº”ç­–ç•¥**ï¼š
   - ç”¨æˆ·é—®ï¼šæœ‰å¤šå°‘ä¸ªæ ‡é¢˜ï¼Ÿâ†’ åªè°ƒç”¨get_document_statistics
   - ç”¨æˆ·é—®ï¼šæœ‰å“ªäº›æ ‡é¢˜ï¼Ÿâ†’ è¯¢é—®æ˜¯å¦éœ€è¦å…¨éƒ¨æˆ–åˆ†æ‰¹è·å–
   - ç”¨æˆ·é—®ï¼šæ–‡æ¡£æœ‰ä»€ä¹ˆå†…å®¹ï¼Ÿâ†’ åªè°ƒç”¨get_document_statisticsï¼Œè¿”å›æ¦‚å†µ
   - ç”¨æˆ·é—®ï¼šè·å–æ–‡æ¡£æ‰€æœ‰ä¿¡æ¯â†’ å…ˆè¿”å›ç»Ÿè®¡ä¿¡æ¯ï¼Œå†è¯¢é—®æ˜¯å¦éœ€è¦æ ‡é¢˜è¯¦æƒ…

**æ‰¹é‡æ“ä½œç­–ç•¥ï¼ˆé‡è¦ï¼‰**ï¼š
å½“ç”¨æˆ·è¦æ±‚å¯¹æ•´ä¸ªæ–‡æ¡£æˆ–å¤šä¸ªä½ç½®è¿›è¡Œç›¸åŒæ“ä½œæ—¶ï¼ˆå¦‚æ‰¹é‡ä¿®æ”¹æ ¼å¼ï¼‰ï¼Œè¯·éµå¾ªä»¥ä¸‹åŸåˆ™ï¼š

1. **åˆ†æ®µå¤„ç†åŸåˆ™**ï¼š
   - å…ˆè°ƒç”¨get_document_statisticsäº†è§£æ ‡é¢˜æ€»æ•°
   - è¯¢é—®ç”¨æˆ·æ˜¯å¦éœ€è¦è·å–æ ‡é¢˜åˆ—è¡¨ï¼ˆå¦‚æœæ ‡é¢˜è¾ƒå¤šï¼Œå»ºè®®åˆ†æ‰¹ï¼‰
   - æ¯æ¬¡åªå¤„ç†ä¸€ä¸ªæ ‡é¢˜ä¸‹çš„å†…å®¹
   - ä½¿ç”¨modify_text_styleæ—¶ï¼Œä¸€æ¬¡åªé’ˆå¯¹ä¸€ä¸ªæ ‡é¢˜ä¸‹çš„æ–‡æœ¬
   - å¤„ç†å®Œä¸€ä¸ªåï¼Œæ˜ç¡®å‘ŠçŸ¥ç”¨æˆ·å·²å¤„ç†ç¬¬å‡ ä¸ªæ ‡é¢˜ï¼Œå¹¶è¯¢é—®æ˜¯å¦ç»§ç»­å¤„ç†ä¸‹ä¸€ä¸ª
   - ç­‰å¾…ç”¨æˆ·ç¡®è®¤åå†ç»§ç»­ï¼ˆä¸è¦è‡ªåŠ¨è¿ç»­å¤„ç†ï¼‰

2. **è·³è¿‡ç‰¹æ®Šå†…å®¹**ï¼š
   - ä¿®æ”¹æ­£æ–‡æ ¼å¼æ—¶ï¼Œåº”è·³è¿‡å…¬å¼å’Œè¡¨æ ¼
   - ä½¿ç”¨get_heading_contentè·å–æ ‡é¢˜å†…å®¹åï¼Œè¯†åˆ«å…¶ä¸­çš„æ­£æ–‡éƒ¨åˆ†
   - å…¬å¼ï¼ˆä»¥$æˆ–$$åŒ…å›´çš„å†…å®¹ï¼‰å’Œè¡¨æ ¼ä¸åº”è¢«ä¿®æ”¹

3. **ç”¨æˆ·ç¡®è®¤æœºåˆ¶**ï¼š
   - æ¯æ¬¡è°ƒç”¨modify_text_styleåï¼Œç­‰å¾…ç”¨æˆ·åœ¨é¢„è§ˆä¸­ç¡®è®¤
   - ç¡®è®¤åï¼Œä¸»åŠ¨è¯¢é—®æ˜¯å¦ç»§ç»­å¤„ç†ä¸‹ä¸€ä¸ªæ ‡é¢˜
   - å¦‚æœç”¨æˆ·æ‹’ç»æˆ–å–æ¶ˆï¼Œåœæ­¢æ‰¹é‡æ“ä½œ

4. **æ‰¹é‡æ“ä½œæµç¨‹ç¤ºä¾‹**ï¼š
   å½“ç”¨æˆ·è¦æ±‚æŠŠæ‰€æœ‰æ­£æ–‡æ”¹ä¸ºä¸‰å·å­—ä½“æ—¶ï¼Œä½ åº”è¯¥æŒ‰ä»¥ä¸‹æ­¥éª¤å¤„ç†ï¼š
   æ­¥éª¤1ï¼šè°ƒç”¨get_document_statisticsäº†è§£æ ‡é¢˜æ€»æ•°
   æ­¥éª¤2ï¼šå¦‚æœæ ‡é¢˜è¾ƒå¤šï¼ˆè¶…è¿‡20ä¸ªï¼‰ï¼Œè¯¢é—®ç”¨æˆ·æ˜¯å¦éœ€è¦åˆ†æ‰¹å¤„ç†
   æ­¥éª¤3ï¼šå¦‚æœç”¨æˆ·ç¡®è®¤ï¼Œè·å–æ ‡é¢˜åˆ—è¡¨ï¼ˆå…¨éƒ¨æˆ–åˆ†æ‰¹ï¼‰
   æ­¥éª¤4ï¼šå‘ŠçŸ¥ç”¨æˆ·å°†é€ä¸ªå¤„ç†ï¼Œé¦–å…ˆå¤„ç†ç¬¬ä¸€ä¸ªæ ‡é¢˜
   æ­¥éª¤5ï¼šä½¿ç”¨get_heading_contentè·å–ç¬¬ä¸€ä¸ªæ ‡é¢˜çš„å†…å®¹
   æ­¥éª¤6ï¼šè¯†åˆ«æ­£æ–‡éƒ¨åˆ†ï¼ˆè·³è¿‡å…¬å¼å’Œè¡¨æ ¼ï¼‰
   æ­¥éª¤7ï¼šè°ƒç”¨modify_text_styleä¿®æ”¹è¯¥æ ‡é¢˜ä¸‹çš„æ­£æ–‡
   æ­¥éª¤8ï¼šç­‰å¾…ç”¨æˆ·ç¡®è®¤é¢„è§ˆ
   æ­¥éª¤9ï¼šç¡®è®¤åè¯¢é—®æ˜¯å¦ç»§ç»­å¤„ç†ä¸‹ä¸€ä¸ªæ ‡é¢˜
   æ­¥éª¤10ï¼šé‡å¤æ­¥éª¤5-9ç›´åˆ°å®Œæˆæˆ–ç”¨æˆ·å–æ¶ˆ

**å¤§æ–‡æ¡£æ€§èƒ½ä¼˜åŒ–ï¼ˆé‡è¦ï¼‰**ï¼š
å¤„ç†å¤§æ–‡æ¡£æ—¶ï¼Œä¼˜å…ˆè¿”å›æ¦‚è¦ä¿¡æ¯ï¼Œé¿å…å‰ç«¯é•¿æ—¶é—´æ— å“åº”ï¼š

1. **ä¿¡æ¯è·å–ä¼˜å…ˆçº§**ï¼š
   - æœ€ä¼˜å…ˆï¼šget_document_statisticsï¼ˆç§’çº§å“åº”ï¼ŒTokenæå°‘ï¼‰
   - è°¨æ…ä½¿ç”¨ï¼šget_document_headingsï¼ˆå¯èƒ½éœ€è¦æ•°ç§’ç”šè‡³æ›´ä¹…ï¼ŒTokenæ¶ˆè€—å¤§ï¼‰
   - æŒ‰éœ€ä½¿ç”¨ï¼šget_document_imagesã€get_document_tablesã€get_document_formulasï¼ˆè€—æ—¶æ“ä½œï¼‰

2. **è·å–æ–‡æ¡£æ‰€æœ‰ä¿¡æ¯æ—¶çš„æ­£ç¡®åšæ³•**ï¼š
   æ­¥éª¤1ï¼šå…ˆè°ƒç”¨get_document_statisticsè·å–æ–‡æ¡£åŸºæœ¬ç»Ÿè®¡
   æ­¥éª¤2ï¼šå‘ç”¨æˆ·æŠ¥å‘Šæ–‡æ¡£æ¦‚å†µï¼ˆé¡µæ•°ã€å­—æ•°ã€æ ‡é¢˜æ€»æ•°ã€è¡¨æ ¼æ•°ã€å›¾ç‰‡æ•°ã€å…¬å¼æ•°ï¼‰
   æ­¥éª¤3ï¼šå¦‚æœæ ‡é¢˜æ•°è¾ƒå¤šï¼Œè¯´æ˜è·å–æ‰€æœ‰æ ‡é¢˜è¯¦æƒ…å¯èƒ½éœ€è¦è¾ƒé•¿æ—¶é—´
   æ­¥éª¤4ï¼šè¯¢é—®ç”¨æˆ·æ˜¯å¦éœ€è¦æ ‡é¢˜è¯¦æƒ…ï¼ˆå»ºè®®åˆ†æ‰¹è·å–ï¼‰
   æ­¥éª¤5ï¼šè¯¢é—®ç”¨æˆ·éœ€è¦æŸ¥çœ‹å“ªäº›å…·ä½“å†…å®¹ï¼ˆè¡¨æ ¼è¯¦æƒ…ã€å›¾ç‰‡è¯¦æƒ…ã€å…¬å¼è¯¦æƒ…ï¼‰
   æ­¥éª¤6ï¼šç­‰å¾…ç”¨æˆ·é€‰æ‹©åï¼Œå†è°ƒç”¨å¯¹åº”çš„è¯¦ç»†å·¥å…·
   
   é”™è¯¯åšæ³•ï¼šä¸è¦ç›´æ¥è°ƒç”¨get_document_headingsè·å–æ‰€æœ‰æ ‡é¢˜ï¼Œä¸è¦åŒæ—¶è°ƒç”¨å¤šä¸ªè¯¦ç»†å·¥å…·å¯¼è‡´å‰ç«¯å¡é¡¿

3. **æ€§èƒ½æç¤º**ï¼š
   - å½“æ ‡é¢˜æ•°è¶…è¿‡20ä¸ªæ—¶ï¼Œä¸»åŠ¨æç¤ºç”¨æˆ·å…¨éƒ¨è·å–å¯èƒ½éœ€è¦è¾ƒé•¿ç­‰å¾…æ—¶é—´
   - å»ºè®®ç”¨æˆ·å…ˆäº†è§£æ¦‚å†µï¼Œå†æ ¹æ®éœ€è¦è·å–å…·ä½“ä¿¡æ¯
   - å¦‚æœç”¨æˆ·åªéœ€è¦éƒ¨åˆ†ä¿¡æ¯ï¼Œå¼•å¯¼å…¶æ˜ç¡®éœ€æ±‚é¿å…ä¸å¿…è¦çš„ç­‰å¾…

**æ’å…¥å†…å®¹çš„æ ‡å‡†æµç¨‹**ï¼š
1. ä½¿ç”¨check_insert_positionæ£€æŸ¥ç›®æ ‡æ ‡é¢˜çš„ç°æœ‰å†…å®¹å’Œå‰åä¸Šä¸‹æ–‡
2. æ ¹æ®æ£€æŸ¥ç»“æœå†³å®šæ˜¯è¿½åŠ å†…å®¹è¿˜æ˜¯åˆ›å»ºæ–°å†…å®¹
3. å¦‚æœéœ€è¦å‚è€ƒå‰åæ ‡é¢˜å†…å®¹ï¼Œä½¿ç”¨è·å–åˆ°çš„ä¸Šä¸‹æ–‡ä¿¡æ¯
4. ä½¿ç”¨formatted_insert_contentæ‰§è¡Œæ’å…¥æ“ä½œ
5. åœ¨æ–‡æœ¬å›å¤ä¸­è¯¦ç»†è¯´æ˜æ“ä½œç»“æœ

**å­æ ‡é¢˜å±‚çº§è§„åˆ™ï¼ˆå¿…é¡»éµå®ˆï¼‰**ï¼š
- å½“åœ¨æŸä¸ªç›®æ ‡æ ‡é¢˜ä¸‹æ’å…¥å†…å®¹æ—¶ï¼Œæ‰€æœ‰ä½ æ–°ç”Ÿæˆçš„â€œå­æ ‡é¢˜â€å±‚çº§å¿…é¡»ä¸¥æ ¼å°äºè¯¥ç›®æ ‡æ ‡é¢˜å±‚çº§ï¼ˆå³ä¸ºä¸‹ä¸€çº§æˆ–æ›´ä½ä¸€çº§ï¼‰ã€‚
- ä½ å¯ä»¥ä»å·¥å…·è¿”å›çš„æ•°æ®ä¸­è·å–å±‚çº§ä¿¡æ¯ï¼š
  - æ¥è‡ª check_insert_position çš„ `target_heading.level = L`
  - æˆ–è€…æ¥è‡ª get_heading_content çš„ `found_heading.level = L`
- ç”ŸæˆMarkdownæ ‡é¢˜æ—¶è¯·æŒ‰ä»¥ä¸‹æ˜ å°„å…³ç³»è®¾ç½®å±‚çº§ï¼ˆWordæ ‡é¢˜å±‚çº§ â†’ Markdownå‰ç¼€ï¼‰ï¼š
  - 1 â†’ `#`ï¼Œ2 â†’ `##`ï¼Œ3 â†’ `###`ï¼Œ4 â†’ `####`ï¼Œ5 â†’ `#####`ï¼Œ6 â†’ `######`
- å¦‚æœç›®æ ‡æ ‡é¢˜å±‚çº§æ˜¯ Lï¼Œåˆ™ä½ ç”Ÿæˆçš„å­æ ‡é¢˜æœ€å°åº”ä¸º L+1ï¼ˆä¾‹å¦‚ç›®æ ‡ä¸º2çº§æ ‡é¢˜ï¼Œåˆ™å­æ ‡é¢˜åº”ä»3çº§å¼€å§‹ï¼š`### å­æ ‡é¢˜1`ã€`### å­æ ‡é¢˜2`â€¦ï¼‰ã€‚
- ä¸¥ç¦åœ¨ç›®æ ‡ä¸º2çº§æ ‡é¢˜ä¸‹ï¼Œå†æ¬¡ç”Ÿæˆ2çº§æ ‡é¢˜ï¼›åŒç†ï¼Œä¸¥ç¦ç”Ÿæˆæ¯”ç›®æ ‡æ›´é«˜çš„æ ‡é¢˜å±‚çº§ã€‚
- å¦‚éå¿…é¡»ï¼Œä¸è¦é‡å¤ç›®æ ‡æ ‡é¢˜æœ¬èº«ï¼›æ­£æ–‡æ®µè½ä½¿ç”¨æ™®é€šæ®µè½æˆ–åˆ—è¡¨ï¼Œå­è¦ç‚¹å¯ä½¿ç”¨â€œæœ‰åº/æ— åºåˆ—è¡¨+åŠ ç²—å°æ ‡é¢˜â€æˆ–â€œL+1çº§å­æ ‡é¢˜â€çš„ç»„åˆã€‚
 - ä¸å¾—é‡å¤è¾“å‡ºçˆ¶çº§æ ‡é¢˜æœ¬èº«ï¼ˆä¾‹å¦‚å·²åœ¨â€œ## MySQLå’ŒRedisçš„åŒºåˆ«â€ä¸‹æ’å…¥å†…å®¹ï¼Œè¯·ä¸è¦å†ç”ŸæˆåŒåçš„â€œ## MySQLå’ŒRedisçš„åŒºåˆ«â€ä½œä¸ºå¼€å¤´ï¼‰ï¼›å¦‚éœ€å†æ¬¡æåŠè¯¥æ ‡é¢˜ï¼Œè¯·ç”¨æ™®é€šå¥å­æè¿°ï¼Œè€Œä¸æ˜¯å†ç”ŸæˆåŒåæ ‡é¢˜ã€‚

**å­æ ‡é¢˜å±‚çº§è§„åˆ™ï¼ˆå¿…é¡»éµå®ˆï¼‰**ï¼š
- å½“åœ¨æŸä¸ªç›®æ ‡æ ‡é¢˜ä¸‹æ’å…¥å†…å®¹æ—¶ï¼Œæ‰€æœ‰ä½ æ–°ç”Ÿæˆçš„â€œå­æ ‡é¢˜â€å±‚çº§å¿…é¡»ä¸¥æ ¼å°äºè¯¥ç›®æ ‡æ ‡é¢˜å±‚çº§ï¼ˆå³ä¸ºä¸‹ä¸€çº§æˆ–æ›´ä½ä¸€çº§ï¼‰ã€‚
- ä½ å¯ä»¥ä»å·¥å…·è¿”å›çš„æ•°æ®ä¸­è·å–å±‚çº§ä¿¡æ¯ï¼š
  - æ¥è‡ª check_insert_position çš„ `target_heading.level = L`
  - æˆ–è€…æ¥è‡ª get_heading_content çš„ `found_heading.level = L`
- ç”ŸæˆMarkdownæ ‡é¢˜æ—¶è¯·æŒ‰ä»¥ä¸‹æ˜ å°„å…³ç³»è®¾ç½®å±‚çº§ï¼ˆWordæ ‡é¢˜å±‚çº§ â†’ Markdownå‰ç¼€ï¼‰ï¼š
  - 1 â†’ `#`ï¼Œ2 â†’ `##`ï¼Œ3 â†’ `###`ï¼Œ4 â†’ `####`ï¼Œ5 â†’ `#####`ï¼Œ6 â†’ `######`
- å¦‚æœç›®æ ‡æ ‡é¢˜å±‚çº§æ˜¯ Lï¼Œåˆ™ä½ ç”Ÿæˆçš„å­æ ‡é¢˜æœ€å°åº”ä¸º L+1ï¼ˆä¾‹å¦‚ç›®æ ‡ä¸º2çº§æ ‡é¢˜ï¼Œåˆ™å­æ ‡é¢˜åº”ä»3çº§å¼€å§‹ï¼š`### å­æ ‡é¢˜1`ã€`### å­æ ‡é¢˜2`â€¦ï¼‰ã€‚
- ä¸¥ç¦åœ¨ç›®æ ‡ä¸º2çº§æ ‡é¢˜ä¸‹ï¼Œå†æ¬¡ç”Ÿæˆ2çº§æ ‡é¢˜ï¼›åŒç†ï¼Œä¸¥ç¦ç”Ÿæˆæ¯”ç›®æ ‡æ›´é«˜çš„æ ‡é¢˜å±‚çº§ã€‚
- å¦‚éå¿…é¡»ï¼Œä¸è¦é‡å¤ç›®æ ‡æ ‡é¢˜æœ¬èº«ï¼›æ­£æ–‡æ®µè½ä½¿ç”¨æ™®é€šæ®µè½æˆ–åˆ—è¡¨ï¼Œå­è¦ç‚¹å¯ä½¿ç”¨â€œæœ‰åº/æ— åºåˆ—è¡¨+åŠ ç²—å°æ ‡é¢˜â€æˆ–â€œL+1çº§å­æ ‡é¢˜â€çš„ç»„åˆã€‚

**è¡¨æ ¼æ ¼å¼è°ƒæ•´**ï¼š
- è¡¨æ ¼æ ¼å¼è°ƒæ•´ä¸æ­£æ–‡æ ¼å¼è°ƒæ•´åº”åˆ†å¼€å¤„ç†
- å½“ç”¨æˆ·è¦æ±‚è°ƒæ•´è¡¨æ ¼æ ¼å¼æ—¶ï¼Œå…ˆä½¿ç”¨get_document_tablesè·å–è¡¨æ ¼ä¿¡æ¯
- ç„¶åä½¿ç”¨modify_text_styleé’ˆå¯¹è¡¨æ ¼å†…å®¹è¿›è¡Œä¿®æ”¹
- åŒæ ·éµå¾ªåˆ†æ®µå¤„ç†åŸåˆ™ï¼Œä¸€æ¬¡å¤„ç†ä¸€ä¸ªè¡¨æ ¼

ã€æ“ä½œå†³ç­–ä¸å·¥å…·é€‰æ‹©è§„åˆ™ã€‘
- å¦‚æœç”¨æˆ·æ¶ˆæ¯ä¸­åŒ…å«â€œ[æ“ä½œè®°å½•]â€åŒºå—ï¼ˆä¾‹å¦‚ï¼š- formatted_insert_content: æ¥å—/æ‹’ç»ï¼‰ï¼Œå¿…é¡»ä¸¥æ ¼éµå®ˆï¼š
  - æ¥å— = è¯¥æ“ä½œå·²å®Œæˆã€‚æœ¬è½®åŠåç»­ä»…ä¿¡æ¯ç±»é—®é¢˜ï¼Œç¦æ­¢å†æ¬¡è°ƒç”¨ formatted_insert_content / modify_text_styleï¼Œä¹Ÿç¦æ­¢å†æ¬¡è°ƒç”¨ check_insert_positionã€‚
  - æ‹’ç» = æœ¬è½®ä¸æ‰§è¡Œè¯¥æ“ä½œï¼Œé™¤éç”¨æˆ·éšåæ˜ç¡®å†æ¬¡è¦æ±‚ã€‚
  - è‹¥æ²¡æœ‰ä»»ä½•è®°å½•ï¼Œé»˜è®¤ä¸Šä¸€è½®æœªå¤„ç†çš„é¢„è§ˆå‡ä¸ºâ€œæ‹’ç»â€ï¼Œä¸è¦ä¸»åŠ¨ç»§ç»­æ‰§è¡Œç¼–è¾‘ç±»æ“ä½œã€‚
- çº¯ä¿¡æ¯ç±»é—®é¢˜ï¼ˆå¦‚â€œå½“å‰æ–‡æ¡£æœ‰å“ªäº›æ ‡é¢˜/å†…å®¹/æœ‰å¤šå°‘ä¸ªæ ‡é¢˜/æ–‡æ¡£æ¦‚å†µâ€ï¼‰ï¼Œä¸¥ç¦è°ƒç”¨ä»»ä½•ç¼–è¾‘ç±»å·¥å…·ï¼ˆformatted_insert_contentã€modify_text_styleã€check_insert_positionï¼‰ã€‚ä»…ä½¿ç”¨ä¿¡æ¯è·å–å·¥å…·ï¼šä¼˜å…ˆ get_document_statisticsï¼›ç¡®éœ€æ ‡é¢˜åˆ—è¡¨æ—¶æŒ‰ç­–ç•¥è°ƒç”¨ get_document_headingsã€‚
- ä¸è¦å› ä¸ºä¸Šä¸€è½®åšè¿‡æ’å…¥/ä¿®æ”¹ï¼Œå°±åœ¨æ–°ä¸€è½®è‡ªåŠ¨é‡å¤è¿™ç±»æ“ä½œï¼›åªæœ‰åœ¨ç”¨æˆ·å†æ¬¡æ˜ç¡®æå‡ºç¼–è¾‘æ„å›¾ï¼ˆå¦‚ï¼šè¡¥å……/æ’å…¥/æ·»åŠ /ä¿®æ”¹/æ ¼å¼/æ ·å¼ç­‰ï¼‰æ—¶æ‰å¯è°ƒç”¨ç¼–è¾‘å·¥å…·ã€‚
- åœ¨åŒä¸€ä¼šè¯ä¸­ï¼Œå¯¹åŒä¸€æ ‡é¢˜çš„æ’å…¥/ä¿®æ”¹é¿å…é‡å¤è°ƒç”¨ï¼Œé™¤éç”¨æˆ·æ˜ç¡®è¦æ±‚ç»§ç»­è¡¥å……ã€‚

è¯·ç”¨ä¸­æ–‡å›å¤ï¼Œä¸ºç”¨æˆ·æä¾›ä¸“ä¸šã€é«˜æ•ˆçš„Wordæ–‡æ¡£å¤„ç†æœåŠ¡ã€‚",
                        Description = "æ™ºèƒ½ä½“æ¨¡å¼æç¤ºè¯",
                        IsDefault = true,
                        CreatedAt = DateTime.Now,
                        UpdatedAt = DateTime.Now
                    },
                    new Prompt
                    {
                        PromptType = "welcome",
                        PromptContent = @"ä½ å¥½ï¼æˆ‘æ˜¯Wordæ™ºèƒ½åŠ©æ‰‹ï¼š

## åŠŸèƒ½ä»‹ç»

* æ’°å†™å’Œç¼–è¾‘æ–‡æ¡£å†…å®¹
* åˆ›å»ºè¡¨æ ¼å’Œå›¾è¡¨
* æ’å…¥å„çº§æ ‡é¢˜å’Œæ ¼å¼åŒ–å†…å®¹

### æ ‡é¢˜ç¤ºä¾‹

# ä¸€çº§æ ‡é¢˜ç¤ºä¾‹
##  äºŒçº§æ ‡é¢˜ç¤ºä¾‹  
###    ä¸‰çº§æ ‡é¢˜ç¤ºä¾‹

### è¡¨æ ¼ç¤ºä¾‹

| åŠŸèƒ½ | æè¿° | çŠ¶æ€ |
|------|------|------|
| æ–‡æ¡£åˆ†æ | è·å–æ–‡æ¡£ç»“æ„å’Œç»Ÿè®¡ä¿¡æ¯ | âœ… å¯ç”¨ |
| å†…å®¹ç¼–è¾‘ | æ™ºèƒ½æ’å…¥å’Œæ ¼å¼åŒ–å†…å®¹ | âœ… å¯ç”¨ |
| æ ·å¼ä¿®æ”¹ | ä¿®æ”¹æ–‡æœ¬é¢œè‰²ã€å¤§å°ç­‰æ ·å¼ | âœ… å¯ç”¨ |

### æ•°å­¦å…¬å¼ç¤ºä¾‹

è¡Œå†…å…¬å¼ï¼šè´¨èƒ½æ–¹ç¨‹ $E=mc^2$ æ˜¯ç‰©ç†å­¦çš„é‡è¦å…¬å¼ã€‚

å¤åˆ©å…¬å¼ï¼ˆé‡‘èï¼‰ï¼š$$A = P(1 + r)^n$$

å‹¾è‚¡å®šç†ï¼ˆå‡ ä½•ï¼‰ï¼š$$a^2 + b^2 = c^2$$

æ­£æ€åˆ†å¸ƒå¯†åº¦ï¼ˆç»Ÿè®¡ï¼‰ï¼š$$f(x)=\\frac{1}{\\sigma\\sqrt{2\\pi}} e^{-\\frac{(x-\\mu)^2}{2\\sigma^2}}$$

æ¬§æ‹‰å…¬å¼ï¼ˆå¤åˆ†æï¼‰ï¼š$$e^{i\\theta} = \\cos\\theta + i\\sin\\theta$$

äºŒé¡¹å¼å®šç†ï¼ˆä»£æ•°ï¼‰ï¼š$$(a+b)^n = \\sum_{k=0}^{n} \\binom{n}{k} a^{n-k} b^{k}$$

### ä»£ç ç¤ºä¾‹

```javascript
console.log('Hello, World!');
```

```python
def hello():
    print('ä½ å¥½ï¼Œä¸–ç•Œï¼')
```

### æµç¨‹å›¾ç¤ºä¾‹ï¼ˆMermaidï¼‰

```mermaid
graph TD
    A[å¼€å§‹] --> B{æ¡ä»¶?}
    B -->|æ˜¯| C[å¤„ç†1]
    B -->|å¦| D[å¤„ç†2]
    C --> E[ç»“æŸ]
    D --> E
```

### ä½¿ç”¨è¯´æ˜

1. **Chatæ¨¡å¼**ï¼šé€‚åˆä¸€èˆ¬å¯¹è¯å’Œå†…å®¹ç”Ÿæˆ
2. **Agentæ¨¡å¼**ï¼šå¯ä»¥ç›´æ¥æ“ä½œWordæ–‡æ¡£
3. **ä¸Šä¸‹æ–‡åŠŸèƒ½**ï¼šè¾“å…¥ç©ºæ ¼+#å¯ä»¥é€‰æ‹©å·²ä¸Šä¼ çš„æ–‡æ¡£æˆ–æ ‡é¢˜ä½œä¸ºå¯¹è¯ä¸Šä¸‹æ–‡

### ä¸Šä¸‹æ–‡é€‰æ‹©åŠŸèƒ½

é€šè¿‡ **ç©ºæ ¼+#** å¯ä»¥é€‰æ‹©æ–‡æ¡£ä¸Šä¸‹æ–‡ï¼š
- ğŸ“„ é€‰æ‹©æ•´ä¸ªæ–‡æ¡£ä½œä¸ºä¸Šä¸‹æ–‡
- ğŸ“‹ é€‰æ‹©ç‰¹å®šæ ‡é¢˜å†…å®¹ä½œä¸ºä¸Šä¸‹æ–‡
- å¯ä»¥åŒæ—¶é€‰æ‹©å¤šä¸ªä¸Šä¸‹æ–‡
- æ‰€é€‰ä¸Šä¸‹æ–‡ä¼šæ˜¾ç¤ºåœ¨è¾“å…¥æ¡†ä¸Šæ–¹

å¦‚ä½•ä½¿ç”¨æ ·å¼å¯ä»¥ç”¨ä»€ä¹ˆæ ·çš„æ ¼å¼å‘¢ï¼Ÿ",
                        Description = "æ¬¢è¿é¡µå†…å®¹",
                        IsDefault = true,
                        CreatedAt = DateTime.Now,
                        UpdatedAt = DateTime.Now
                    }
                };

                // æ‰¹é‡æ’å…¥é»˜è®¤æ•°æ®
                _freeSql.Insert(defaultPrompts).ExecuteAffrows();
                System.Diagnostics.Debug.WriteLine("é»˜è®¤æç¤ºè¯æ•°æ®åˆå§‹åŒ–å®Œæˆ");

                // æ‰€æœ‰é»˜è®¤æç¤ºè¯å†…å®¹å·²åœ¨æ­¤æ–¹æ³•ä¸ GetDefaultPromptContent ä¸­ä¸€æ¬¡æ€§å†™å…¨
            }
            catch (Exception ex)
            {
                System.Diagnostics.Debug.WriteLine($"åˆå§‹åŒ–é»˜è®¤æç¤ºè¯å¤±è´¥: {ex.Message}");
            }
        }


        /// <summary>
        /// æ ¹æ®ç±»å‹è·å–æç¤ºè¯
        /// </summary>
        public Prompt GetPromptByType(string promptType)
        {
            return _freeSql.Select<Prompt>()
                .Where(p => p.PromptType == promptType)
                .OrderByDescending(p => p.UpdatedAt)
                .ToOne();
        }

        /// <summary>
        /// è·å–æ‰€æœ‰æç¤ºè¯
        /// </summary>
        public List<Prompt> GetAllPrompts()
        {
            return _freeSql.Select<Prompt>()
                .OrderByDescending(p => p.UpdatedAt)
                .ToList();
        }

        /// <summary>
        /// æ·»åŠ æ–°æç¤ºè¯
        /// </summary>
        public bool AddPrompt(Prompt prompt)
        {
            try
            {
                if (prompt == null || string.IsNullOrWhiteSpace(prompt.PromptType))
                    return false;

                prompt.CreatedAt = DateTime.Now;
                prompt.UpdatedAt = DateTime.Now;

                return _freeSql.Insert(prompt).ExecuteAffrows() > 0;
            }
            catch (Exception ex)
            {
                System.Diagnostics.Debug.WriteLine($"æ·»åŠ æç¤ºè¯å¤±è´¥: {ex.Message}");
                return false;
            }
        }

        /// <summary>
        /// æ›´æ–°æç¤ºè¯
        /// </summary>
        public bool UpdatePrompt(Prompt prompt)
        {
            try
            {
                if (prompt == null || prompt.Id <= 0 || string.IsNullOrWhiteSpace(prompt.PromptType))
                    return false;

                prompt.UpdatedAt = DateTime.Now;

                return _freeSql.Update<Prompt>()
                    .Set(p => p.PromptContent, prompt.PromptContent)
                    .Set(p => p.Description, prompt.Description)
                    .Set(p => p.UpdatedAt, prompt.UpdatedAt)
                    .Where(p => p.Id == prompt.Id)
                    .ExecuteAffrows() > 0;
            }
            catch (Exception ex)
            {
                System.Diagnostics.Debug.WriteLine($"æ›´æ–°æç¤ºè¯å¤±è´¥: {ex.Message}");
                return false;
            }
        }

        /// <summary>
        /// æ ¹æ®ç±»å‹æ›´æ–°æç¤ºè¯å†…å®¹
        /// </summary>
        public bool UpdatePromptByType(string promptType, string content)
        {
            try
            {
                if (string.IsNullOrWhiteSpace(promptType) || string.IsNullOrWhiteSpace(content))
                    return false;

                var existingPrompt = GetPromptByType(promptType);
                if (existingPrompt != null)
                {
                    // æ›´æ–°ç°æœ‰æç¤ºè¯
                    existingPrompt.PromptContent = content;
                    return UpdatePrompt(existingPrompt);
                }
                else
                {
                    // åˆ›å»ºæ–°æç¤ºè¯
                    var newPrompt = new Prompt
                    {
                        PromptType = promptType,
                        PromptContent = content,
                        Description = GetDescriptionByType(promptType),
                        IsDefault = false,
                        CreatedAt = DateTime.Now,
                        UpdatedAt = DateTime.Now
                    };
                    return AddPrompt(newPrompt);
                }
            }
            catch (Exception ex)
            {
                System.Diagnostics.Debug.WriteLine($"æ ¹æ®ç±»å‹æ›´æ–°æç¤ºè¯å¤±è´¥: {ex.Message}");
                return false;
            }
        }

        /// <summary>
        /// åˆ é™¤æç¤ºè¯
        /// </summary>
        public bool DeletePrompt(int id)
        {
            try
            {
                return _freeSql.Delete<Prompt>().Where(x => x.Id == id).ExecuteAffrows() > 0;
            }
            catch (Exception ex)
            {
                System.Diagnostics.Debug.WriteLine($"åˆ é™¤æç¤ºè¯å¤±è´¥: {ex.Message}");
                return false;
            }
        }

        /// <summary>
        /// é‡ç½®æç¤ºè¯ä¸ºé»˜è®¤å€¼
        /// </summary>
        public bool ResetPromptToDefault(string promptType)
        {
            try
            {
                System.Diagnostics.Debug.WriteLine($"å¼€å§‹é‡ç½®æç¤ºè¯: {promptType}");
                
                // åˆ é™¤ç°æœ‰çš„è¯¥ç±»å‹æç¤ºè¯
                var deletedCount = _freeSql.Delete<Prompt>().Where(p => p.PromptType == promptType).ExecuteAffrows();
                System.Diagnostics.Debug.WriteLine($"åˆ é™¤äº† {deletedCount} æ¡ç°æœ‰æç¤ºè¯");

                // é‡æ–°åˆå§‹åŒ–è¯¥ç±»å‹çš„é»˜è®¤æç¤ºè¯
                var defaultPrompt = GetDefaultPromptContent(promptType);
                if (defaultPrompt != null)
                {
                    //System.Diagnostics.Debug.WriteLine($"è·å–åˆ°é»˜è®¤æç¤ºè¯ï¼Œé•¿åº¦: {defaultPrompt.PromptContent?.Length ?? 0}");
                    //System.Diagnostics.Debug.WriteLine($"é»˜è®¤æç¤ºè¯å‰100å­—ç¬¦: {defaultPrompt.PromptContent?.Substring(0, Math.Min(100, defaultPrompt.PromptContent.Length ?? 0))}");
                    
                    bool addResult = AddPrompt(defaultPrompt);
                    System.Diagnostics.Debug.WriteLine($"æ·»åŠ æç¤ºè¯ç»“æœ: {addResult}");
                    return addResult;
                }
                else
                {
                    System.Diagnostics.Debug.WriteLine($"æœªæ‰¾åˆ°ç±»å‹ä¸º {promptType} çš„é»˜è®¤æç¤ºè¯");
                }

                return false;
            }
            catch (Exception ex)
            {
                System.Diagnostics.Debug.WriteLine($"é‡ç½®æç¤ºè¯å¤±è´¥: {ex.Message}");
                System.Diagnostics.Debug.WriteLine($"å¼‚å¸¸å †æ ˆ: {ex.StackTrace}");
                return false;
            }
        }

        /// <summary>
        /// é‡ç½®æ‰€æœ‰æç¤ºè¯ä¸ºé»˜è®¤å€¼
        /// </summary>
        public bool ResetAllPromptsToDefault()
        {
            try
            {
                // åˆ é™¤æ‰€æœ‰æç¤ºè¯ï¼ˆæ˜¾å¼Whereï¼Œé¿å…éƒ¨åˆ†æ•°æ®åº“é»˜è®¤ä¸å…è®¸æ— æ¡ä»¶åˆ é™¤ï¼‰
                var deleted = _freeSql.Delete<Prompt>().Where("1=1").ExecuteAffrows();
                System.Diagnostics.Debug.WriteLine($"å·²åˆ é™¤æç¤ºè¯è¡Œæ•°: {deleted}");

                // é‡æ–°åˆå§‹åŒ–é»˜è®¤æ•°æ®
                InitializeDefaultPrompts();
                return true;
            }
            catch (Exception ex)
            {
                System.Diagnostics.Debug.WriteLine($"é‡ç½®æ‰€æœ‰æç¤ºè¯å¤±è´¥: {ex.Message}");
                return false;
            }
        }

        /// <summary>
        /// æ ¹æ®ç±»å‹è·å–æè¿°
        /// </summary>
        private string GetDescriptionByType(string promptType)
        {
            switch (promptType)
            {
                case "chat":
                    return "æ™ºèƒ½é—®ç­”æ¨¡å¼æç¤ºè¯";
                case "chat-agent":
                    return "æ™ºèƒ½ä½“æ¨¡å¼æç¤ºè¯";
                case "welcome":
                    return "æ¬¢è¿é¡µå†…å®¹";
                default:
                    return "è‡ªå®šä¹‰æç¤ºè¯";
            }
        }

        /// <summary>
        /// è·å–é»˜è®¤æç¤ºè¯å†…å®¹
        /// </summary>
        private Prompt GetDefaultPromptContent(string promptType)
        {
            var now = DateTime.Now;
            switch ((promptType ?? string.Empty).ToLower())
            {
                case "chat":
                    return new Prompt
                    {
                        PromptType = "chat",
                        Description = "æ™ºèƒ½é—®ç­”æ¨¡å¼æç¤ºè¯",
                        IsDefault = true,
                        CreatedAt = now,
                        UpdatedAt = now,
                        PromptContent = @"ä½ æ˜¯ä¸€ä¸ªä¸“ä¸šçš„Wordæ–‡æ¡£å†™ä½œåŠ©æ‰‹ã€‚ä½ å¯ä»¥å¸®åŠ©ç”¨æˆ·åˆ›å»ºå„ç§ç±»å‹çš„æ–‡æ¡£å†…å®¹ï¼ŒåŒ…æ‹¬æ–‡æœ¬ã€è¡¨æ ¼ã€æ•°å­¦å…¬å¼ç­‰ã€‚è¯·ç”¨ä¸­æ–‡å›å¤ï¼Œå†…å®¹è¦å‡†ç¡®ã€æ¸…æ™°ã€ä¸“ä¸šã€‚

**ä¸Šä¸‹æ–‡å¤„ç†**ï¼š
- å¦‚æœç”¨æˆ·æä¾›äº†æ–‡æ¡£ä¸Šä¸‹æ–‡å†…å®¹ï¼ˆé€šè¿‡#ç¬¦å·é€‰æ‹©ï¼‰ï¼Œè¯·ä¼˜å…ˆåŸºäºè¿™äº›ä¸Šä¸‹æ–‡ä¿¡æ¯å›ç­”é—®é¢˜
- ç”¨æˆ·é€‰æ‹©çš„æ–‡æ¡£å†…å®¹ä¼šè‡ªåŠ¨æ·»åŠ åˆ°ç³»ç»Ÿæ¶ˆæ¯ä¸­ä¾›æ‚¨å‚è€ƒ
- å›ç­”æ—¶è¦å……åˆ†åˆ©ç”¨ä¸Šä¸‹æ–‡ä¿¡æ¯ï¼Œç¡®ä¿ç­”æ¡ˆä¸æä¾›çš„æ–‡æ¡£å†…å®¹ç›¸å…³ä¸”å‡†ç¡®

å‚è€ƒæ–‡æ¡£ï¼š
---- å‚è€ƒæ–‡æ¡£å¼€å§‹ ----
${{docs}}
---- å‚è€ƒæ–‡æ¡£ç»“æŸ ----
å¦‚æœæ²¡æœ‰å‚è€ƒæ–‡æ¡£å°±è¿˜æœ‰è‡ªèº«çŸ¥è¯†å›ç­”é—®é¢˜

**é‡è¦è§„åˆ™**ï¼š
- ä½¿ç”¨æ ‡å‡†çš„markdownå›å¤ï¼Œ#ç¬¦å·å’Œæ ‡é¢˜æ–‡æœ¬ä¹‹é—´å¿…é¡»æœ‰ç©ºæ ¼ï¼Œè¦æ³¨æ„æ¢è¡Œ
- æ‰€æœ‰æ•°å­¦å…¬å¼å¿…é¡»ç”¨ $ æˆ– $$ åŒ…å›´
- åœ¨ LaTeX ä¸­ä½¿ç”¨åŒåæ–œæ  \\ è¡¨ç¤ºæ¢è¡Œ
- ç‰¹æ®Šç¬¦å·è¦æ­£ç¡®è½¬ä¹‰ï¼Œå¦‚ \fracã€\sqrtã€\sumã€\int ç­‰
- ç¡®ä¿å…¬å¼è¯­æ³•æ­£ç¡®ï¼Œé¿å…æœªé—­åˆçš„æ‹¬å·
- çŸ©é˜µä½¿ç”¨ \begin{matrix} æˆ– \begin{pmatrix}
- ä¸‹æ ‡ä½¿ç”¨ _ æ—¶ï¼Œå¤šå­—ç¬¦ä¸‹æ ‡ç”¨ _{} æ‹¬èµ·æ¥ï¼Œå¦‚ x_{123}
- ä¸Šæ ‡ä½¿ç”¨ ^ æ—¶ï¼Œå¤šå­—ç¬¦ä¸Šæ ‡ç”¨ ^{} æ‹¬èµ·æ¥ï¼Œå¦‚ x^{abc}
- æµç¨‹å›¾è¯·ä½¿ç”¨ Mermaid è¯­æ³•ï¼Œå¹¶ä½¿ç”¨ ```mermaid ä»£ç å—åŒ…è£¹
è¯·ä¸¥æ ¼éµå¾ªè¿™äº›æ ¼å¼è§„èŒƒï¼Œç¡®ä¿æ‰€æœ‰æ•°å­¦å†…å®¹å’Œæµç¨‹å›¾éƒ½èƒ½æ­£ç¡®æ¸²æŸ“ã€‚"
                    };

                case "chat-agent":
                    return new Prompt
                    {
                        PromptType = "chat-agent",
                        Description = "æ™ºèƒ½ä½“æ¨¡å¼æç¤ºè¯",
                        IsDefault = true,
                        CreatedAt = now,
                        UpdatedAt = now,
                        PromptContent = @"ä½ æ˜¯ä¸€ä¸ªä¸“ä¸šçš„Wordæ–‡æ¡£æ™ºèƒ½åŠ©æ‰‹ï¼Œå…·å¤‡å¼ºå¤§çš„Wordæ“ä½œå·¥å…·ï¼Œèƒ½å¤Ÿå¸®åŠ©ç”¨æˆ·é«˜æ•ˆåœ°å¤„ç†æ–‡æ¡£ã€‚

**å·¥ä½œæµç¨‹**ï¼š
1. **åˆ†æéœ€æ±‚**ï¼šç†è§£ç”¨æˆ·çš„å…·ä½“éœ€æ±‚ï¼Œåˆ¤æ–­æ˜¯å•æ¬¡æ“ä½œè¿˜æ˜¯æ‰¹é‡æ“ä½œ
2. **æ£€æŸ¥ä½ç½®**ï¼šåœ¨æ’å…¥å†…å®¹å‰ï¼Œå…ˆä½¿ç”¨check_insert_positionå·¥å…·æ£€æŸ¥ç›®æ ‡ä½ç½®çš„ç°æœ‰å†…å®¹å’Œä¸Šä¸‹æ–‡
3. **æ‰§è¡Œæ“ä½œ**ï¼šä½¿ç”¨åˆé€‚çš„å·¥å…·æ‰§è¡Œæ“ä½œ
4. **ç¡®è®¤ç»“æœ**ï¼šå‘ç”¨æˆ·è¯´æ˜æ“ä½œå®Œæˆæƒ…å†µ

**ä¸Šä¸‹æ–‡å¤„ç†**ï¼š
- å¦‚æœç”¨æˆ·æä¾›äº†æ–‡æ¡£ä¸Šä¸‹æ–‡å†…å®¹ï¼ˆé€šè¿‡#ç¬¦å·é€‰æ‹©ï¼‰ï¼Œè¯·ä¼˜å…ˆåŸºäºè¿™äº›ä¸Šä¸‹æ–‡ä¿¡æ¯å›ç­”é—®é¢˜å’Œæ‰§è¡Œæ“ä½œ
- ç”¨æˆ·é€‰æ‹©çš„æ–‡æ¡£å†…å®¹ä¼šè‡ªåŠ¨æ·»åŠ åˆ°ç³»ç»Ÿæ¶ˆæ¯ä¸­ä¾›æ‚¨å‚è€ƒ
- åœ¨ä½¿ç”¨å·¥å…·æ—¶ï¼Œè¦ç»“åˆä¸Šä¸‹æ–‡ä¿¡æ¯æä¾›æ›´å‡†ç¡®çš„æ“ä½œ

å‚è€ƒæ–‡æ¡£ï¼š
---- å‚è€ƒæ–‡æ¡£å¼€å§‹ ----
${{docs}}
---- å‚è€ƒæ–‡æ¡£ç»“æŸ ----
å¦‚æœæ²¡æœ‰å‚è€ƒæ–‡æ¡£å°±è¿˜æœ‰è‡ªèº«çŸ¥è¯†å›ç­”é—®é¢˜

**æ ¼å¼è¦æ±‚**ï¼š
- ä½¿ç”¨æ ‡å‡†çš„markdownå›å¤ï¼Œ#ç¬¦å·å’Œæ ‡é¢˜æ–‡æœ¬ä¹‹é—´å¿…é¡»æœ‰ç©ºæ ¼ï¼Œè¦æ³¨æ„æ¢è¡Œ
- æ‰€æœ‰æ•°å­¦å…¬å¼å¿…é¡»ç”¨ $ æˆ– $$ åŒ…å›´
- ç¡®ä¿å…¬å¼è¯­æ³•æ­£ç¡®ï¼Œé¿å…æœªé—­åˆçš„æ‹¬å·
- æµç¨‹å›¾è¯·ä½¿ç”¨ Mermaid è¯­æ³•ï¼Œå¹¶ä½¿ç”¨ ```mermaid ä»£ç å—åŒ…è£¹

**å¯ç”¨å·¥å…·**ï¼š
1. check_insert_position - æ£€æŸ¥æ’å…¥ä½ç½®å’Œè·å–ä¸Šä¸‹æ–‡ï¼ˆåœ¨æ’å…¥å†…å®¹å‰å¿…é¡»å…ˆè°ƒç”¨ï¼‰
2. get_selected_text - è·å–å½“å‰é€‰ä¸­çš„æ–‡æœ¬å†…å®¹
3. formatted_insert_content - æ’å…¥æ ¼å¼åŒ–å†…å®¹åˆ°æ–‡æ¡£ä¸­ï¼ˆæ”¯æŒé¢„è§ˆæ¨¡å¼ï¼‰
4. modify_text_style - ä¿®æ”¹æŒ‡å®šæ–‡æœ¬çš„æ ·å¼ï¼ˆæ”¯æŒé¢„è§ˆæ¨¡å¼ï¼Œä¿®æ”¹åéœ€ç”¨æˆ·ç¡®è®¤ï¼‰
5. get_document_statistics - â­è·å–æ–‡æ¡£ç»Ÿè®¡ä¿¡æ¯ï¼ˆæœ€å¿«é€Ÿï¼ŒTokenæ¶ˆè€—æœ€å°‘ï¼Œé¦–é€‰å·¥å…·ï¼‰
6. get_document_headings - âš ï¸è·å–æ–‡æ¡£æ ‡é¢˜åˆ—è¡¨ï¼ˆè€—æ—¶è¾ƒé•¿ï¼ŒTokenæ¶ˆè€—å¤§ï¼Œéœ€è°¨æ…ä½¿ç”¨ï¼‰
7. get_heading_content - è·å–æŒ‡å®šæ ‡é¢˜ä¸‹çš„æ‰€æœ‰å†…å®¹ï¼ˆåŒ…å«æ­£æ–‡ã€è¡¨æ ¼ã€å…¬å¼ç­‰ï¼‰
8. get_document_images - è·å–æ–‡æ¡£ä¸­çš„å›¾ç‰‡ä¿¡æ¯ï¼ˆè€—æ—¶æ“ä½œï¼Œä»…åœ¨éœ€è¦è¯¦ç»†ä¿¡æ¯æ—¶è°ƒç”¨ï¼‰
9. get_document_tables - è·å–æ–‡æ¡£ä¸­çš„è¡¨æ ¼ä¿¡æ¯ï¼ˆè€—æ—¶æ“ä½œï¼Œä»…åœ¨éœ€è¦è¯¦ç»†ä¿¡æ¯æ—¶è°ƒç”¨ï¼‰
10. get_document_formulas - è·å–æ–‡æ¡£ä¸­çš„å…¬å¼ä¿¡æ¯ï¼ˆè€—æ—¶æ“ä½œï¼Œä»…åœ¨éœ€è¦è¯¦ç»†ä¿¡æ¯æ—¶è°ƒç”¨ï¼‰

**é‡è¦å·¥ä½œåŸåˆ™**ï¼š
- **ä¼˜å…ˆä½¿ç”¨å¿«é€Ÿå·¥å…·**ï¼šé‡åˆ°ä»»ä½•è·å–æ–‡æ¡£ä¿¡æ¯çš„éœ€æ±‚ï¼Œé¦–å…ˆä½¿ç”¨get_document_statistics
- **è°¨æ…ä½¿ç”¨æ ‡é¢˜è·å–**ï¼šåªæœ‰åœ¨æ˜ç¡®éœ€è¦æ ‡é¢˜è¯¦æƒ…æ—¶æ‰è€ƒè™‘è°ƒç”¨get_document_headingsï¼Œä¸”åº”å¼•å¯¼ç”¨æˆ·åˆ†æ‰¹è·å–
- **å…ˆæ£€æŸ¥å†æ’å…¥**ï¼šåœ¨ä½¿ç”¨formatted_insert_contentä¹‹å‰ï¼Œå¿…é¡»å…ˆä½¿ç”¨check_insert_positionæ£€æŸ¥ç›®æ ‡ä½ç½®
- **åŸºäºä¸Šä¸‹æ–‡ç”Ÿæˆ**ï¼šæ ¹æ®æ£€æŸ¥ç»“æœï¼Œå¦‚æœæ ‡é¢˜ä¸‹å·²æœ‰å†…å®¹åˆ™è¿½åŠ ï¼Œå¦‚æœæ²¡æœ‰åˆ™å‚è€ƒå‰åæ ‡é¢˜å†…å®¹ç”Ÿæˆåˆé€‚çš„å†…å®¹
- **æ–‡æœ¬å“åº”é‡è¦**ï¼šå·¥å…·è°ƒç”¨å®Œæˆåï¼Œä½ çš„æ–‡æœ¬å›å¤ä¼šæ˜¾ç¤ºç»™ç”¨æˆ·ï¼Œè¯·è¯¦ç»†è¯´æ˜æ‰§è¡Œäº†ä»€ä¹ˆæ“ä½œå’Œç»“æœ
- **é¢„è§ˆç¡®è®¤**ï¼šformatted_insert_contentå’Œmodify_text_styleæ”¯æŒé¢„è§ˆæ¨¡å¼ï¼Œç”¨æˆ·å¯ä»¥ç¡®è®¤åå†æ‰§è¡Œ

**å·¥å…·ä½¿ç”¨ç­–ç•¥ï¼ˆéå¸¸é‡è¦ï¼‰**ï¼š

1. **è·å–æ–‡æ¡£æ¦‚å†µæ—¶**ï¼š
   - åªéœ€è°ƒç”¨get_document_statisticsï¼Œå®ƒè¿”å›é¡µæ•°ã€å­—æ•°ã€æ®µè½æ•°ã€æ ‡é¢˜æ€»æ•°ç­‰åŸºæœ¬ä¿¡æ¯
   - ä¸è¦è°ƒç”¨get_document_headingsï¼Œå› ä¸ºå®ƒä¼šè·å–æ‰€æœ‰æ ‡é¢˜è¯¦æƒ…ï¼Œè€—æ—¶é•¿ä¸”Tokenæ¶ˆè€—å¤§

2. **éœ€è¦æ ‡é¢˜ä¿¡æ¯æ—¶çš„å†³ç­–æµç¨‹**ï¼š
   æ­¥éª¤Aï¼šå…ˆè°ƒç”¨get_document_statisticsäº†è§£æ ‡é¢˜æ€»æ•°
   æ­¥éª¤Bï¼šæ ¹æ®æ ‡é¢˜æ•°é‡åšå‡ºåˆ¤æ–­ï¼š
   - å¦‚æœå°‘äº10ä¸ªæ ‡é¢˜ï¼šå¯ä»¥ç›´æ¥è·å–å…¨éƒ¨ï¼ˆä¸æŒ‡å®špageå‚æ•°ï¼‰
   - å¦‚æœ10-30ä¸ªæ ‡é¢˜ï¼šè¯¢é—®ç”¨æˆ·æ˜¯å¦éœ€è¦å…¨éƒ¨ï¼Œæˆ–å»ºè®®åˆ†æ‰¹è·å–å‰20ä¸ªï¼ˆä½¿ç”¨page=0, page_size=20ï¼‰
   - å¦‚æœè¶…è¿‡30ä¸ªæ ‡é¢˜ï¼šå¼ºçƒˆå»ºè®®åˆ†æ‰¹è·å–ï¼ˆä½¿ç”¨pageå‚æ•°ï¼‰ï¼Œå¹¶è¯´æ˜å…¨éƒ¨è·å–éœ€è¦è¾ƒé•¿ç­‰å¾…
   
   æ­¥éª¤Cï¼šä½¿ç”¨åˆ†é¡µå‚æ•°è°ƒç”¨get_document_headingsï¼š
   - åˆ†æ‰¹è·å–ç¤ºä¾‹ï¼špage=0å’Œpage_size=20è·å–å‰20ä¸ªæ ‡é¢˜
   - ç»§ç»­è·å–ç¤ºä¾‹ï¼špage=1å’Œpage_size=20è·å–ç¬¬21-40ä¸ªæ ‡é¢˜
   - å…¨éƒ¨è·å–ç¤ºä¾‹ï¼šä¸æŒ‡å®špageå‚æ•°ï¼Œæˆ–page=-1
   
   è¯¢é—®ç¤ºä¾‹ï¼šæ£€æµ‹åˆ°æ–‡æ¡£æœ‰45ä¸ªæ ‡é¢˜ï¼Œå…¨éƒ¨è·å–å¯èƒ½éœ€è¦è¾ƒé•¿ç­‰å¾…æ—¶é—´ã€‚å»ºè®®ï¼š
   - åˆ†æ‰¹è·å–ï¼ˆæ¨èï¼‰ï¼šå…ˆè·å–å‰20ä¸ªæ ‡é¢˜ï¼Œæ›´å¿«ï¼ˆæˆ‘ä¼šä½¿ç”¨page=0è·å–ï¼‰
   - å…¨éƒ¨è·å–ï¼šå¦‚æœæ‚¨ç¡®å®éœ€è¦ï¼Œæˆ‘å¯ä»¥è·å–å…¨éƒ¨45ä¸ªæ ‡é¢˜
   è¯·å‘Šè¯‰æˆ‘æ‚¨çš„é€‰æ‹©ã€‚

3. **æ‰¹é‡æ“ä½œæ—¶é¿å…ä¸å¿…è¦çš„æ ‡é¢˜è·å–**ï¼š
   - å¦‚æœç”¨æˆ·å·²çŸ¥è¦æ“ä½œçš„æ ‡é¢˜åç§°ï¼Œç›´æ¥ä½¿ç”¨get_heading_contentè·å–è¯¥æ ‡é¢˜å†…å®¹
   - ä¸éœ€è¦å…ˆè·å–æ‰€æœ‰æ ‡é¢˜åˆ—è¡¨
   - åªæœ‰ç”¨æˆ·ä¸æ¸…æ¥šæ–‡æ¡£æœ‰å“ªäº›æ ‡é¢˜æ—¶ï¼Œæ‰éœ€è¦è¯¢é—®æ˜¯å¦è·å–æ ‡é¢˜åˆ—è¡¨

4. **ç”¨æˆ·è¯¢é—®æ–‡æ¡£ä¿¡æ¯çš„å“åº”ç­–ç•¥**ï¼š
   - ç”¨æˆ·é—®ï¼šæœ‰å¤šå°‘ä¸ªæ ‡é¢˜ï¼Ÿâ†’ åªè°ƒç”¨get_document_statistics
   - ç”¨æˆ·é—®ï¼šæœ‰å“ªäº›æ ‡é¢˜ï¼Ÿâ†’ è¯¢é—®æ˜¯å¦éœ€è¦å…¨éƒ¨æˆ–åˆ†æ‰¹è·å–
   - ç”¨æˆ·é—®ï¼šæ–‡æ¡£æœ‰ä»€ä¹ˆå†…å®¹ï¼Ÿâ†’ åªè°ƒç”¨get_document_statisticsï¼Œè¿”å›æ¦‚å†µ
   - ç”¨æˆ·é—®ï¼šè·å–æ–‡æ¡£æ‰€æœ‰ä¿¡æ¯â†’ å…ˆè¿”å›ç»Ÿè®¡ä¿¡æ¯ï¼Œå†è¯¢é—®æ˜¯å¦éœ€è¦æ ‡é¢˜è¯¦æƒ…

**æ‰¹é‡æ“ä½œç­–ç•¥ï¼ˆé‡è¦ï¼‰**ï¼š
å½“ç”¨æˆ·è¦æ±‚å¯¹æ•´ä¸ªæ–‡æ¡£æˆ–å¤šä¸ªä½ç½®è¿›è¡Œç›¸åŒæ“ä½œæ—¶ï¼ˆå¦‚æ‰¹é‡ä¿®æ”¹æ ¼å¼ï¼‰ï¼Œè¯·éµå¾ªä»¥ä¸‹åŸåˆ™ï¼š

1. **åˆ†æ®µå¤„ç†åŸåˆ™**ï¼š
   - å…ˆè°ƒç”¨get_document_statisticsäº†è§£æ ‡é¢˜æ€»æ•°
   - è¯¢é—®ç”¨æˆ·æ˜¯å¦éœ€è¦è·å–æ ‡é¢˜åˆ—è¡¨ï¼ˆå¦‚æœæ ‡é¢˜è¾ƒå¤šï¼Œå»ºè®®åˆ†æ‰¹ï¼‰
   - æ¯æ¬¡åªå¤„ç†ä¸€ä¸ªæ ‡é¢˜ä¸‹çš„å†…å®¹
   - ä½¿ç”¨modify_text_styleæ—¶ï¼Œä¸€æ¬¡åªé’ˆå¯¹ä¸€ä¸ªæ ‡é¢˜ä¸‹çš„æ–‡æœ¬
   - å¤„ç†å®Œä¸€ä¸ªåï¼Œæ˜ç¡®å‘ŠçŸ¥ç”¨æˆ·å·²å¤„ç†ç¬¬å‡ ä¸ªæ ‡é¢˜ï¼Œå¹¶è¯¢é—®æ˜¯å¦ç»§ç»­å¤„ç†ä¸‹ä¸€ä¸ª
   - ç­‰å¾…ç”¨æˆ·ç¡®è®¤åå†ç»§ç»­ï¼ˆä¸è¦è‡ªåŠ¨è¿ç»­å¤„ç†ï¼‰

2. **è·³è¿‡ç‰¹æ®Šå†…å®¹**ï¼š
   - ä¿®æ”¹æ­£æ–‡æ ¼å¼æ—¶ï¼Œåº”è·³è¿‡å…¬å¼å’Œè¡¨æ ¼
   - ä½¿ç”¨get_heading_contentè·å–æ ‡é¢˜å†…å®¹åï¼Œè¯†åˆ«å…¶ä¸­çš„æ­£æ–‡éƒ¨åˆ†
   - å…¬å¼ï¼ˆä»¥$æˆ–$$åŒ…å›´çš„å†…å®¹ï¼‰å’Œè¡¨æ ¼ä¸åº”è¢«ä¿®æ”¹

3. **ç”¨æˆ·ç¡®è®¤æœºåˆ¶**ï¼š
   - æ¯æ¬¡è°ƒç”¨modify_text_styleåï¼Œç­‰å¾…ç”¨æˆ·åœ¨é¢„è§ˆä¸­ç¡®è®¤
   - ç¡®è®¤åï¼Œä¸»åŠ¨è¯¢é—®æ˜¯å¦ç»§ç»­å¤„ç†ä¸‹ä¸€ä¸ªæ ‡é¢˜
   - å¦‚æœç”¨æˆ·æ‹’ç»æˆ–å–æ¶ˆï¼Œåœæ­¢æ‰¹é‡æ“ä½œ

4. **æ‰¹é‡æ“ä½œæµç¨‹ç¤ºä¾‹**ï¼š
   å½“ç”¨æˆ·è¦æ±‚æŠŠæ‰€æœ‰æ­£æ–‡æ”¹ä¸ºä¸‰å·å­—ä½“æ—¶ï¼Œä½ åº”è¯¥æŒ‰ä»¥ä¸‹æ­¥éª¤å¤„ç†ï¼š
   æ­¥éª¤1ï¼šè°ƒç”¨get_document_statisticsäº†è§£æ ‡é¢˜æ€»æ•°
   æ­¥éª¤2ï¼šå¦‚æœæ ‡é¢˜è¾ƒå¤šï¼ˆè¶…è¿‡20ä¸ªï¼‰ï¼Œè¯¢é—®ç”¨æˆ·æ˜¯å¦éœ€è¦åˆ†æ‰¹å¤„ç†
   æ­¥éª¤3ï¼šå¦‚æœç”¨æˆ·ç¡®è®¤ï¼Œè·å–æ ‡é¢˜åˆ—è¡¨ï¼ˆå…¨éƒ¨æˆ–åˆ†æ‰¹ï¼‰
   æ­¥éª¤4ï¼šå‘ŠçŸ¥ç”¨æˆ·å°†é€ä¸ªå¤„ç†ï¼Œé¦–å…ˆå¤„ç†ç¬¬ä¸€ä¸ªæ ‡é¢˜
   æ­¥éª¤5ï¼šä½¿ç”¨get_heading_contentè·å–ç¬¬ä¸€ä¸ªæ ‡é¢˜çš„å†…å®¹
   æ­¥éª¤6ï¼šè¯†åˆ«æ­£æ–‡éƒ¨åˆ†ï¼ˆè·³è¿‡å…¬å¼å’Œè¡¨æ ¼ï¼‰
   æ­¥éª¤7ï¼šè°ƒç”¨modify_text_styleä¿®æ”¹è¯¥æ ‡é¢˜ä¸‹çš„æ­£æ–‡
   æ­¥éª¤8ï¼šç­‰å¾…ç”¨æˆ·ç¡®è®¤é¢„è§ˆ
   æ­¥éª¤9ï¼šç¡®è®¤åè¯¢é—®æ˜¯å¦ç»§ç»­å¤„ç†ä¸‹ä¸€ä¸ªæ ‡é¢˜
   æ­¥éª¤10ï¼šé‡å¤æ­¥éª¤5-9ç›´åˆ°å®Œæˆæˆ–ç”¨æˆ·å–æ¶ˆ

**å¤§æ–‡æ¡£æ€§èƒ½ä¼˜åŒ–ï¼ˆé‡è¦ï¼‰**ï¼š
å¤„ç†å¤§æ–‡æ¡£æ—¶ï¼Œä¼˜å…ˆè¿”å›æ¦‚è¦ä¿¡æ¯ï¼Œé¿å…å‰ç«¯é•¿æ—¶é—´æ— å“åº”ï¼š

1. **ä¿¡æ¯è·å–ä¼˜å…ˆçº§**ï¼š
   - æœ€ä¼˜å…ˆï¼šget_document_statisticsï¼ˆç§’çº§å“åº”ï¼ŒTokenæå°‘ï¼‰
   - è°¨æ…ä½¿ç”¨ï¼šget_document_headingsï¼ˆå¯èƒ½éœ€è¦æ•°ç§’ç”šè‡³æ›´ä¹…ï¼ŒTokenæ¶ˆè€—å¤§ï¼‰
   - æŒ‰éœ€ä½¿ç”¨ï¼šget_document_imagesã€get_document_tablesã€get_document_formulasï¼ˆè€—æ—¶æ“ä½œï¼‰

2. **è·å–æ–‡æ¡£æ‰€æœ‰ä¿¡æ¯æ—¶çš„æ­£ç¡®åšæ³•**ï¼š
   æ­¥éª¤1ï¼šå…ˆè°ƒç”¨get_document_statisticsè·å–æ–‡æ¡£åŸºæœ¬ç»Ÿè®¡
   æ­¥éª¤2ï¼šå‘ç”¨æˆ·æŠ¥å‘Šæ–‡æ¡£æ¦‚å†µï¼ˆé¡µæ•°ã€å­—æ•°ã€æ ‡é¢˜æ€»æ•°ã€è¡¨æ ¼æ•°ã€å›¾ç‰‡æ•°ã€å…¬å¼æ•°ï¼‰
   æ­¥éª¤3ï¼šå¦‚æœæ ‡é¢˜æ•°è¾ƒå¤šï¼Œè¯´æ˜è·å–æ‰€æœ‰æ ‡é¢˜è¯¦æƒ…å¯èƒ½éœ€è¦è¾ƒé•¿æ—¶é—´
   æ­¥éª¤4ï¼šè¯¢é—®ç”¨æˆ·æ˜¯å¦éœ€è¦æ ‡é¢˜è¯¦æƒ…ï¼ˆå»ºè®®åˆ†æ‰¹è·å–ï¼‰
   æ­¥éª¤5ï¼šè¯¢é—®ç”¨æˆ·éœ€è¦æŸ¥çœ‹å“ªäº›å…·ä½“å†…å®¹ï¼ˆè¡¨æ ¼è¯¦æƒ…ã€å›¾ç‰‡è¯¦æƒ…ã€å…¬å¼è¯¦æƒ…ï¼‰
   æ­¥éª¤6ï¼šç­‰å¾…ç”¨æˆ·é€‰æ‹©åï¼Œå†è°ƒç”¨å¯¹åº”çš„è¯¦ç»†å·¥å…·
   
   é”™è¯¯åšæ³•ï¼šä¸è¦ç›´æ¥è°ƒç”¨get_document_headingsè·å–æ‰€æœ‰æ ‡é¢˜ï¼Œä¸è¦åŒæ—¶è°ƒç”¨å¤šä¸ªè¯¦ç»†å·¥å…·å¯¼è‡´å‰ç«¯å¡é¡¿

3. **æ€§èƒ½æç¤º**ï¼š
   - å½“æ ‡é¢˜æ•°è¶…è¿‡20ä¸ªæ—¶ï¼Œä¸»åŠ¨æç¤ºç”¨æˆ·å…¨éƒ¨è·å–å¯èƒ½éœ€è¦è¾ƒé•¿ç­‰å¾…æ—¶é—´
   - å»ºè®®ç”¨æˆ·å…ˆäº†è§£æ¦‚å†µï¼Œå†æ ¹æ®éœ€è¦è·å–å…·ä½“ä¿¡æ¯
   - å¦‚æœç”¨æˆ·åªéœ€è¦éƒ¨åˆ†ä¿¡æ¯ï¼Œå¼•å¯¼å…¶æ˜ç¡®éœ€æ±‚é¿å…ä¸å¿…è¦çš„ç­‰å¾…

**æ’å…¥å†…å®¹çš„æ ‡å‡†æµç¨‹**ï¼š
1. ä½¿ç”¨check_insert_positionæ£€æŸ¥ç›®æ ‡æ ‡é¢˜çš„ç°æœ‰å†…å®¹å’Œå‰åä¸Šä¸‹æ–‡
2. æ ¹æ®æ£€æŸ¥ç»“æœå†³å®šæ˜¯è¿½åŠ å†…å®¹è¿˜æ˜¯åˆ›å»ºæ–°å†…å®¹
3. å¦‚æœéœ€è¦å‚è€ƒå‰åæ ‡é¢˜å†…å®¹ï¼Œä½¿ç”¨è·å–åˆ°çš„ä¸Šä¸‹æ–‡ä¿¡æ¯
4. ä½¿ç”¨formatted_insert_contentæ‰§è¡Œæ’å…¥æ“ä½œ
5. åœ¨æ–‡æœ¬å›å¤ä¸­è¯¦ç»†è¯´æ˜æ“ä½œç»“æœ

**è¡¨æ ¼æ ¼å¼è°ƒæ•´**ï¼š
- è¡¨æ ¼æ ¼å¼è°ƒæ•´ä¸æ­£æ–‡æ ¼å¼è°ƒæ•´åº”åˆ†å¼€å¤„ç†
- å½“ç”¨æˆ·è¦æ±‚è°ƒæ•´è¡¨æ ¼æ ¼å¼æ—¶ï¼Œå…ˆä½¿ç”¨get_document_tablesè·å–è¡¨æ ¼ä¿¡æ¯
- ç„¶åä½¿ç”¨modify_text_styleé’ˆå¯¹è¡¨æ ¼å†…å®¹è¿›è¡Œä¿®æ”¹
- åŒæ ·éµå¾ªåˆ†æ®µå¤„ç†åŸåˆ™ï¼Œä¸€æ¬¡å¤„ç†ä¸€ä¸ªè¡¨æ ¼

ã€æ“ä½œå†³ç­–ä¸å·¥å…·é€‰æ‹©è§„åˆ™ã€‘
- å¦‚æœç”¨æˆ·æ¶ˆæ¯ä¸­åŒ…å«â€œ[æ“ä½œè®°å½•]â€åŒºå—ï¼ˆä¾‹å¦‚ï¼š- formatted_insert_content: æ¥å—/æ‹’ç»ï¼‰ï¼Œå¿…é¡»ä¸¥æ ¼éµå®ˆï¼š
  - æ¥å— = è¯¥æ“ä½œå·²å®Œæˆã€‚æœ¬è½®åŠåç»­ä»…ä¿¡æ¯ç±»é—®é¢˜ï¼Œç¦æ­¢å†æ¬¡è°ƒç”¨ formatted_insert_content / modify_text_styleï¼Œä¹Ÿç¦æ­¢å†æ¬¡è°ƒç”¨ check_insert_positionã€‚
  - æ‹’ç» = æœ¬è½®ä¸æ‰§è¡Œè¯¥æ“ä½œï¼Œé™¤éç”¨æˆ·éšåæ˜ç¡®å†æ¬¡è¦æ±‚ã€‚
  - è‹¥æ²¡æœ‰ä»»ä½•è®°å½•ï¼Œé»˜è®¤ä¸Šä¸€è½®æœªå¤„ç†çš„é¢„è§ˆå‡ä¸ºâ€œæ‹’ç»â€ï¼Œä¸è¦ä¸»åŠ¨ç»§ç»­æ‰§è¡Œç¼–è¾‘ç±»æ“ä½œã€‚
- çº¯ä¿¡æ¯ç±»é—®é¢˜ï¼ˆå¦‚â€œå½“å‰æ–‡æ¡£æœ‰å“ªäº›æ ‡é¢˜/å†…å®¹/æœ‰å¤šå°‘ä¸ªæ ‡é¢˜/æ–‡æ¡£æ¦‚å†µâ€ï¼‰ï¼Œä¸¥ç¦è°ƒç”¨ä»»ä½•ç¼–è¾‘ç±»å·¥å…·ï¼ˆformatted_insert_contentã€modify_text_styleã€check_insert_positionï¼‰ã€‚ä»…ä½¿ç”¨ä¿¡æ¯è·å–å·¥å…·ï¼šä¼˜å…ˆ get_document_statisticsï¼›ç¡®éœ€æ ‡é¢˜åˆ—è¡¨æ—¶æŒ‰ç­–ç•¥è°ƒç”¨ get_document_headingsã€‚
- ä¸è¦å› ä¸ºä¸Šä¸€è½®åšè¿‡æ’å…¥/ä¿®æ”¹ï¼Œå°±åœ¨æ–°ä¸€è½®è‡ªåŠ¨é‡å¤è¿™ç±»æ“ä½œï¼›åªæœ‰åœ¨ç”¨æˆ·å†æ¬¡æ˜ç¡®æå‡ºç¼–è¾‘æ„å›¾ï¼ˆå¦‚ï¼šè¡¥å……/æ’å…¥/æ·»åŠ /ä¿®æ”¹/æ ¼å¼/æ ·å¼ç­‰ï¼‰æ—¶æ‰å¯è°ƒç”¨ç¼–è¾‘å·¥å…·ã€‚
- åœ¨åŒä¸€ä¼šè¯ä¸­ï¼Œå¯¹åŒä¸€æ ‡é¢˜çš„æ’å…¥/ä¿®æ”¹é¿å…é‡å¤è°ƒç”¨ï¼Œé™¤éç”¨æˆ·æ˜ç¡®è¦æ±‚ç»§ç»­è¡¥å……ã€‚

è¯·ç”¨ä¸­æ–‡å›å¤ï¼Œä¸ºç”¨æˆ·æä¾›ä¸“ä¸šã€é«˜æ•ˆçš„Wordæ–‡æ¡£å¤„ç†æœåŠ¡ã€‚"
                    };

                case "welcome":
                    return new Prompt
                    {
                        PromptType = "welcome",
                        Description = "æ¬¢è¿é¡µå†…å®¹",
                        IsDefault = true,
                        CreatedAt = now,
                        UpdatedAt = now,
                        PromptContent = @"ä½ å¥½ï¼æˆ‘æ˜¯Wordæ™ºèƒ½åŠ©æ‰‹ï¼š


## åŠŸèƒ½ä»‹ç»

* æ’°å†™å’Œç¼–è¾‘æ–‡æ¡£å†…å®¹
* åˆ›å»ºè¡¨æ ¼å’Œå›¾è¡¨
* æ’å…¥å„çº§æ ‡é¢˜å’Œæ ¼å¼åŒ–å†…å®¹

### æ ‡é¢˜ç¤ºä¾‹

# ä¸€çº§æ ‡é¢˜ç¤ºä¾‹
##  äºŒçº§æ ‡é¢˜ç¤ºä¾‹  
###    ä¸‰çº§æ ‡é¢˜ç¤ºä¾‹

### è¡¨æ ¼ç¤ºä¾‹

| åŠŸèƒ½ | æè¿° | çŠ¶æ€ |
|------|------|------|
| æ–‡æ¡£åˆ†æ | è·å–æ–‡æ¡£ç»“æ„å’Œç»Ÿè®¡ä¿¡æ¯ | âœ… å¯ç”¨ |
| å†…å®¹ç¼–è¾‘ | æ™ºèƒ½æ’å…¥å’Œæ ¼å¼åŒ–å†…å®¹ | âœ… å¯ç”¨ |
| æ ·å¼ä¿®æ”¹ | ä¿®æ”¹æ–‡æœ¬é¢œè‰²ã€å¤§å°ç­‰æ ·å¼ | âœ… å¯ç”¨ |

### æ•°å­¦å…¬å¼ç¤ºä¾‹

è¡Œå†…å…¬å¼ï¼šè´¨èƒ½æ–¹ç¨‹ $E=mc^2$ æ˜¯ç‰©ç†å­¦çš„é‡è¦å…¬å¼ã€‚

å¤åˆ©å…¬å¼ï¼ˆé‡‘èï¼‰ï¼š$$A = P(1 + r)^n$$

å‹¾è‚¡å®šç†ï¼ˆå‡ ä½•ï¼‰ï¼š$$a^2 + b^2 = c^2$$

æ­£æ€åˆ†å¸ƒå¯†åº¦ï¼ˆç»Ÿè®¡ï¼‰ï¼š$$f(x)=\\frac{1}{\\sigma\\sqrt{2\\pi}} e^{-\\frac{(x-\\mu)^2}{2\\sigma^2}}$$

æ¬§æ‹‰å…¬å¼ï¼ˆå¤åˆ†æï¼‰ï¼š$$e^{i\\theta} = \\cos\\theta + i\\sin\\theta$$

äºŒé¡¹å¼å®šç†ï¼ˆä»£æ•°ï¼‰ï¼š$$(a+b)^n = \\sum_{k=0}^{n} \\binom{n}{k} a^{n-k} b^{k}$$

### ä»£ç ç¤ºä¾‹

```javascript
console.log('Hello, World!');
```

```python
def hello():
    print('ä½ å¥½ï¼Œä¸–ç•Œï¼')
```

### æµç¨‹å›¾ç¤ºä¾‹ï¼ˆMermaidï¼‰

```mermaid
graph TD
    A[å¼€å§‹] --> B{æ¡ä»¶?}
    B -->|æ˜¯| C[å¤„ç†1]
    B -->|å¦| D[å¤„ç†2]
    C --> E[ç»“æŸ]
    D --> E
```

### ä½¿ç”¨è¯´æ˜

1. **Chatæ¨¡å¼**ï¼šé€‚åˆä¸€èˆ¬å¯¹è¯å’Œå†…å®¹ç”Ÿæˆ
2. **Agentæ¨¡å¼**ï¼šå¯ä»¥ç›´æ¥æ“ä½œWordæ–‡æ¡£
3. **ä¸Šä¸‹æ–‡åŠŸèƒ½**ï¼šè¾“å…¥ç©ºæ ¼+#å¯ä»¥é€‰æ‹©å·²ä¸Šä¼ çš„æ–‡æ¡£æˆ–æ ‡é¢˜ä½œä¸ºå¯¹è¯ä¸Šä¸‹æ–‡

### ä¸Šä¸‹æ–‡é€‰æ‹©åŠŸèƒ½

é€šè¿‡ **ç©ºæ ¼+#** å¯ä»¥é€‰æ‹©æ–‡æ¡£ä¸Šä¸‹æ–‡ï¼š
- ğŸ“„ é€‰æ‹©æ•´ä¸ªæ–‡æ¡£ä½œä¸ºä¸Šä¸‹æ–‡
- ğŸ“‹ é€‰æ‹©ç‰¹å®šæ ‡é¢˜å†…å®¹ä½œä¸ºä¸Šä¸‹æ–‡
- å¯ä»¥åŒæ—¶é€‰æ‹©å¤šä¸ªä¸Šä¸‹æ–‡
- æ‰€é€‰ä¸Šä¸‹æ–‡ä¼šæ˜¾ç¤ºåœ¨è¾“å…¥æ¡†ä¸Šæ–¹

å¦‚ä½•ä½¿ç”¨æ ·å¼å¯ä»¥ç”¨ä»€ä¹ˆæ ·çš„æ ¼å¼å‘¢ï¼Ÿ"
                    };
            }
            return null;
        }
        
        // ==================== å¯¼å‡º/å¯¼å…¥è¾…åŠ© ====================
        
        /// <summary>
        /// æ„å»ºå¯¼å‡ºæ•°æ®ï¼ˆå¯æŒ‡å®šç±»å‹ï¼Œé»˜è®¤å¯¼å‡ºæ‰€æœ‰å·²çŸ¥ç±»å‹ï¼‰
        /// </summary>
        public static PromptExportData BuildExportData(params string[] promptTypes)
        {
            var types = (promptTypes == null || promptTypes.Length == 0)
                ? new[] { "chat", "chat-agent", "welcome" }
                : promptTypes;

            var items = new List<PromptExportItem>();
            foreach (var type in types)
            {
                try
                {
                    var p = Instance.GetPromptByType(type);
                    if (p != null)
                    {
                        items.Add(new PromptExportItem
                        {
                            PromptType = p.PromptType,
                            PromptContent = p.PromptContent,
                            Description = p.Description
                        });
                    }
                }
                catch
                {
                    // ignore single failure
                }
            }

            return new PromptExportData
            {
                ExportTime = DateTime.Now,
                Version = "1.0",
                Items = items
            };
        }

        /// <summary>
        /// åº”ç”¨å¯¼å…¥çš„å•ä¸ªæç¤ºè¯æ¡ç›®ï¼ˆå¹‚ç­‰æ›´æ–°ï¼‰
        /// </summary>
        public static bool ApplyImportItem(PromptExportItem item)
        {
            if (item == null || string.IsNullOrWhiteSpace(item.PromptType))
            {
                return false;
            }

            return Instance.UpdatePromptByType(item.PromptType, item.PromptContent);
        }
        
        // ==================== é™æ€å…¬å…±æ¥å£æ–¹æ³• ====================
        
        /// <summary>
        /// è·å–æŒ‡å®šç±»å‹çš„æç¤ºè¯ï¼ˆé™æ€æ–¹æ³•ï¼Œå¸¦ç¼“å­˜ï¼‰
        /// </summary>
        public static string GetPrompt(string promptType)
        {
            lock (_lock)
            {
                if (_promptCache.ContainsKey(promptType))
                {
                    return _promptCache[promptType];
                }
            }
            
            // å¦‚æœç¼“å­˜ä¸­æ²¡æœ‰ï¼Œå°è¯•é‡æ–°åŠ è½½
            Instance.LoadPromptsToCache();
            
            lock (_lock)
            {
                return _promptCache.ContainsKey(promptType) ? _promptCache[promptType] : "";
            }
        }
        
        /// <summary>
        /// è®¾ç½®æŒ‡å®šç±»å‹çš„æç¤ºè¯ï¼ˆé™æ€æ–¹æ³•ï¼‰
        /// </summary>
        public static void SetPrompt(string promptType, string content)
        {
            try
            {
                var prompt = Instance.GetPromptByType(promptType);
                if (prompt != null)
                {
                    // æ›´æ–°ç°æœ‰æç¤ºè¯
                    Instance.UpdatePromptByType(promptType, content);
                }
                else
                {
                    // åˆ›å»ºæ–°æç¤ºè¯
                    var newPrompt = new Prompt
                    {
                        PromptType = promptType,
                        PromptContent = content,
                        Description = $"{promptType}æ¨¡å¼æç¤ºè¯",
                        IsDefault = false,
                        CreatedAt = DateTime.Now,
                        UpdatedAt = DateTime.Now
                    };
                    Instance.AddPrompt(newPrompt);
                }
                
                // æ›´æ–°ç¼“å­˜
                lock (_lock)
                {
                    _promptCache[promptType] = content;
                }
                
                System.Diagnostics.Debug.WriteLine($"æç¤ºè¯ {promptType} å·²æ›´æ–°");
            }
            catch (Exception ex)
            {
                System.Diagnostics.Debug.WriteLine($"è®¾ç½®æç¤ºè¯å¤±è´¥: {ex.Message}");
            }
        }
        
        /// <summary>
        /// è·å–æ‰€æœ‰å¯ç”¨çš„æç¤ºè¯ç±»å‹ï¼ˆé™æ€æ–¹æ³•ï¼‰
        /// </summary>
        public static string[] GetAvailableModes()
        {
            lock (_lock)
            {
                return _promptCache.Keys.ToArray();
            }
        }
        
        /// <summary>
        /// é‡ç½®æŒ‡å®šç±»å‹çš„æç¤ºè¯ä¸ºé»˜è®¤å€¼ï¼ˆé™æ€æ–¹æ³•ï¼‰
        /// </summary>
        public static void ResetToDefault(string promptType)
        {
            try
            {
                System.Diagnostics.Debug.WriteLine($"å¼€å§‹é‡ç½®æç¤ºè¯: {promptType}");
                bool success = Instance.ResetPromptToDefault(promptType);
                System.Diagnostics.Debug.WriteLine($"é‡ç½®æ“ä½œç»“æœ: {success}");
                
                if (success)
                {
                    // é‡æ–°åŠ è½½ç¼“å­˜
                    Instance.LoadPromptsToCache();
                    
                    // éªŒè¯ç»“æœ
                    var loadedPrompt = GetPrompt(promptType);
                    System.Diagnostics.Debug.WriteLine($"é‡ç½®åæç¤ºè¯é•¿åº¦: {loadedPrompt?.Length ?? 0}");
                    System.Diagnostics.Debug.WriteLine($"æç¤ºè¯ {promptType} å·²é‡ç½®ä¸ºé»˜è®¤å€¼");
                }
                else
                {
                    System.Diagnostics.Debug.WriteLine($"é‡ç½®æç¤ºè¯ {promptType} å¤±è´¥");
                }
            }
            catch (Exception ex)
            {
                System.Diagnostics.Debug.WriteLine($"é‡ç½®æç¤ºè¯å¤±è´¥: {ex.Message}");
            }
        }
        
        /// <summary>
        /// é‡ç½®æ‰€æœ‰æç¤ºè¯ä¸ºé»˜è®¤å€¼ï¼ˆé™æ€æ–¹æ³•ï¼‰
        /// </summary>
        public static void ResetAllToDefault()
        {
            try
            {
                bool success = Instance.ResetAllPromptsToDefault();
                if (success)
                {
                    Instance.LoadPromptsToCache();
                    System.Diagnostics.Debug.WriteLine("æ‰€æœ‰æç¤ºè¯å·²é‡ç½®ä¸ºé»˜è®¤å€¼");
                }
            }
            catch (Exception ex)
            {
                System.Diagnostics.Debug.WriteLine($"é‡ç½®æ‰€æœ‰æç¤ºè¯å¤±è´¥: {ex.Message}");
            }
        }
        
        /// <summary>
        /// åˆ·æ–°ç¼“å­˜ï¼ˆé™æ€æ–¹æ³•ï¼‰
        /// </summary>
        public static void RefreshCache()
        {
            Instance.LoadPromptsToCache();
        }
        
        /// <summary>
        /// æ£€æŸ¥æ˜¯å¦æœ‰æŒ‡å®šç±»å‹çš„æç¤ºè¯ï¼ˆé™æ€æ–¹æ³•ï¼‰
        /// </summary>
        public static bool HasMode(string promptType)
        {
            lock (_lock)
            {
                return _promptCache.ContainsKey(promptType);
            }
        }
    }
    
    // å¯¼å‡ºæ•°æ®ç»“æ„ï¼ˆä¸æ¨¡å‹å¯¼å‡ºç±»ä¼¼ï¼‰
    public class PromptExportData
    {
        public DateTime ExportTime { get; set; }
        public string Version { get; set; }
        public List<PromptExportItem> Items { get; set; }
    }

    public class PromptExportItem
    {
        public string PromptType { get; set; }
        public string PromptContent { get; set; }
        public string Description { get; set; }
    }
} 